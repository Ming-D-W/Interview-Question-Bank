---
title: JavaScript
---

# JavaScript é¢è¯•çŸ¥è¯†ä½“ç³»

## ğŸ“š ç›®å½•å¯¼èˆª

### ä¸€ã€åŸºç¡€ç¯‡
- [æ•°æ®ç±»å‹](#æ•°æ®ç±»å‹)
- [æ•°æ®ç±»å‹åˆ¤æ–­](#æ•°æ®ç±»å‹åˆ¤æ–­)
- [ç±»å‹è½¬æ¢](#ç±»å‹è½¬æ¢)
- [å˜é‡å£°æ˜](#å˜é‡å£°æ˜)
- [å˜é‡æå‡](#å˜é‡æå‡)
- [æš‚æ—¶æ€§æ­»åŒº](#æš‚æ—¶æ€§æ­»åŒº)
- [ä½œç”¨åŸŸé“¾](#ä½œç”¨åŸŸé“¾)
- [æ‰§è¡Œä¸Šä¸‹æ–‡](#æ‰§è¡Œä¸Šä¸‹æ–‡)
- [æ‰§è¡Œæ ˆ](#æ‰§è¡Œæ ˆ)

### äºŒã€å‡½æ•°ç¯‡
- [thisæŒ‡å‘](#thisæŒ‡å‘)
- [callã€applyã€bind](#callapplybindçš„åŒºåˆ«)
- [ç®­å¤´å‡½æ•°](#ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«)
- [é»˜è®¤å‚æ•°](#é»˜è®¤å‚æ•°)
- [é—­åŒ…](#é—­åŒ…)

### ä¸‰ã€å¯¹è±¡ç¯‡
- [newå…³é”®å­—](#newå…³é”®å­—çš„æ‰§è¡Œè¿‡ç¨‹)
- [åŸå‹é“¾](#åŸå‹é“¾)
- [ç»§æ‰¿](#ç»§æ‰¿)
- [classç±»](#classç±»)

### å››ã€å¼‚æ­¥ç¯‡
- [å›è°ƒå‡½æ•°](#å›è°ƒå‡½æ•°)
- [Promise](#promise)
- [async/await](#asyncawait)
- [äº‹ä»¶å¾ªç¯](#äº‹ä»¶å¾ªç¯)
- [å®ä»»åŠ¡&å¾®ä»»åŠ¡](#å®ä»»åŠ¡å¾®ä»»åŠ¡)

### äº”ã€ES6+ç¯‡
- [let & const](#let-const)
- [è§£æ„èµ‹å€¼](#è§£æ„èµ‹å€¼)
- [æ¨¡æ¿å­—ç¬¦ä¸²](#æ¨¡æ¿å­—ç¬¦ä¸²)
- [æ‰©å±•è¿ç®—ç¬¦](#æ‰©å±•è¿ç®—ç¬¦)
- [Set & Map](#setmap)
- [for...in & for...of](#for-in--for-of)

### å…­ã€å¸¸ç”¨APIç¯‡
- [æ•°ç»„æ–¹æ³•](#æ•°ç»„çš„å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›)
- [å­—ç¬¦ä¸²æ–¹æ³•](#å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•)
- [å¯¹è±¡æ–¹æ³•](#å¯¹è±¡å¸¸ç”¨æ–¹æ³•)

### ä¸ƒã€æµè§ˆå™¨ç¯‡
- [Cookieã€LocalStorageã€SessionStorage](#cookielocalstoragesessionstorage)
- [è·¨åŸŸè§£å†³æ–¹æ¡ˆ](#è·¨åŸŸè§£å†³æ–¹æ¡ˆ)
- [Ajax å’Œ Fetch](#ajax-å’Œ-fetch)

### å…«ã€å·¥ç¨‹åŒ–ç¯‡
- [æ•°æ®å¤„ç†](#æ•°ç»„è½¬æ ‘å½¢ç»“æ„)
- [æ·±æ‹·è´](#æ‰‹å†™æ·±æ‹·è´)
- [é˜²æŠ–èŠ‚æµ](#é˜²æŠ–èŠ‚æµ)
- [å†…å­˜æ³„æ¼](#å†…å­˜æ³„æ¼)
- [äº‹ä»¶å§”æ‰˜&äº‹ä»¶å†’æ³¡](#äº‹ä»¶å§”æ‰˜äº‹ä»¶å†’æ³¡)
- [é”™è¯¯æ•è·](#å‰ç«¯å¦‚ä½•æ•è·é”™è¯¯)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

### ä¹ã€æ‰‹å†™å®ç°ç¯‡
- [æ‰‹å†™call/apply/bind](#æ‰‹å†™call)
- [æ‰‹å†™new](#æ‰‹å†™new)
- [æ‰‹å†™instanceof](#æ‰‹å†™instanceof)
- [æ‰‹å†™Promise](#æ‰‹å†™promise)
- [æ‰‹å†™æ·±æ‹·è´](#æ‰‹å†™æ·±æ‹·è´)
- [æ‰‹å†™é˜²æŠ–èŠ‚æµ](#æ‰‹å†™é˜²æŠ–)
- [æ‰‹å†™æŸ¯é‡ŒåŒ–](#æ‰‹å†™æŸ¯é‡ŒåŒ–)

### åã€å…¶ä»–ç¯‡
- [Proxyå’ŒReflect](#proxyå’Œreflect)
- [ä¸¥æ ¼æ¨¡å¼](#ä¸¥æ ¼æ¨¡å¼)

---

# ä¸€ã€åŸºç¡€ç¯‡

æœ¬ç¯‡æ¶µç›–JavaScriptçš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ•°æ®ç±»å‹ã€å˜é‡å£°æ˜ã€ä½œç”¨åŸŸã€æ‰§è¡Œæœºåˆ¶ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚

## æ•°æ®ç±»å‹

JavaScriptæœ‰8ç§æ•°æ®ç±»å‹ï¼š

**åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ7ç§ï¼‰**
- Numberï¼ˆæ•°å­—ï¼‰
- Stringï¼ˆå­—ç¬¦ä¸²ï¼‰
- Booleanï¼ˆå¸ƒå°”ï¼‰
- Undefinedï¼ˆæœªå®šä¹‰ï¼‰
- Nullï¼ˆç©ºï¼‰
- Symbolï¼ˆç¬¦å·ï¼ŒES6æ–°å¢ï¼‰
- BigIntï¼ˆå¤§æ•´æ•°ï¼ŒES2020æ–°å¢ï¼‰

**å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆ1ç§ï¼‰**
- Objectï¼ˆå¯¹è±¡ï¼‰ï¼ŒåŒ…æ‹¬ï¼šObjectã€Arrayã€Functionã€Dateã€RegExpã€Mapã€Setç­‰

**åŒºåˆ«ï¼š**
1. å­˜å‚¨ä½ç½®ä¸åŒï¼šåŸºæœ¬ç±»å‹å­˜å‚¨åœ¨æ ˆä¸­ï¼Œå¼•ç”¨ç±»å‹å­˜å‚¨åœ¨å †ä¸­ï¼Œæ ˆä¸­å­˜å‚¨çš„æ˜¯å¼•ç”¨åœ°å€
2. èµ‹å€¼æ–¹å¼ä¸åŒï¼šåŸºæœ¬ç±»å‹èµ‹å€¼æ˜¯å€¼çš„æ‹·è´ï¼Œå¼•ç”¨ç±»å‹èµ‹å€¼æ˜¯åœ°å€çš„æ‹·è´
3. æ¯”è¾ƒæ–¹å¼ä¸åŒï¼šåŸºæœ¬ç±»å‹æ¯”è¾ƒå€¼ï¼Œå¼•ç”¨ç±»å‹æ¯”è¾ƒåœ°å€

## æ•°æ®ç±»å‹åˆ¤æ–­

**1. typeof**

å¯ä»¥åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆé™¤äº†nullï¼‰ï¼Œä½†å¯¹äºå¼•ç”¨ç±»å‹ï¼Œé™¤äº†functionè¿”å›"function"ï¼Œå…¶ä»–éƒ½è¿”å›"object"ã€‚

```js
typeof 123 // "number"
typeof '123' // "string"
typeof true // "boolean"
typeof undefined // "undefined"
typeof null // "object" (å†å²é—ç•™bug)
typeof Symbol() // "symbol"
typeof 10n // "bigint"
typeof {} // "object"
typeof [] // "object"
typeof function(){} // "function"
```

**2. instanceof**

ç”¨äºåˆ¤æ–­å¯¹è±¡çš„å…·ä½“ç±»å‹ï¼Œæ£€æŸ¥æ„é€ å‡½æ•°çš„prototypeæ˜¯å¦åœ¨å¯¹è±¡çš„åŸå‹é“¾ä¸Šã€‚

```js
[] instanceof Array // true
[] instanceof Object // true
{} instanceof Object // true
function(){} instanceof Function // true
```

**3. Object.prototype.toString.call()**

æœ€å‡†ç¡®çš„ç±»å‹åˆ¤æ–­æ–¹æ³•ï¼Œå¯ä»¥åˆ¤æ–­æ‰€æœ‰æ•°æ®ç±»å‹ã€‚

```js
Object.prototype.toString.call(123) // "[object Number]"
Object.prototype.toString.call('123') // "[object String]"
Object.prototype.toString.call(true) // "[object Boolean]"
Object.prototype.toString.call(undefined) // "[object Undefined]"
Object.prototype.toString.call(null) // "[object Null]"
Object.prototype.toString.call({}) // "[object Object]"
Object.prototype.toString.call([]) // "[object Array]"
Object.prototype.toString.call(function(){}) // "[object Function]"
Object.prototype.toString.call(new Date()) // "[object Date]"
Object.prototype.toString.call(/\d/) // "[object RegExp]"
```

**4. Array.isArray()**

ä¸“é—¨ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºæ•°ç»„ã€‚

```js
Array.isArray([]) // true
Array.isArray({}) // false
```

## ç±»å‹è½¬æ¢

**éšå¼ç±»å‹è½¬æ¢**

JavaScriptåœ¨è¿ç®—è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ã€‚

```js
// è½¬ä¸ºå­—ç¬¦ä¸²
1 + '2' // "12"
'5' + 1 // "51"

// è½¬ä¸ºæ•°å­—
'5' - 2 // 3
'5' * '2' // 10
'5' / 2 // 2.5
'5' % 2 // 1

// è½¬ä¸ºå¸ƒå°”å€¼
!!0 // false
!!'hello' // true
if ('hello') {} // true

// == è¿ç®—ç¬¦çš„éšå¼è½¬æ¢
null == undefined // true
0 == false // true
'' == false // true
[] == false // true
[] == ![] // true (å¤æ‚çš„è½¬æ¢è§„åˆ™)
```

**æ˜¾å¼ç±»å‹è½¬æ¢**

```js
// è½¬ä¸ºå­—ç¬¦ä¸²
String(123) // "123"
(123).toString() // "123"

// è½¬ä¸ºæ•°å­—
Number('123') // 123
parseInt('123px') // 123
parseFloat('12.3.4') // 12.3
+'123' // 123 (ä¸€å…ƒåŠ è¿ç®—ç¬¦)

// è½¬ä¸ºå¸ƒå°”å€¼
Boolean(0) // false
Boolean('hello') // true

// å‡å€¼ï¼ˆè½¬ä¸ºå¸ƒå°”å€¼ä¸ºfalseçš„å€¼ï¼‰
// false, 0, '', null, undefined, NaN
```

## å˜é‡å£°æ˜

**varã€letã€constçš„åŒºåˆ«ï¼š**

1. **ä½œç”¨åŸŸä¸åŒ**
   - varå£°æ˜çš„å˜é‡ä½œç”¨åŸŸæ˜¯å‡½æ•°çº§åˆ«çš„
   - letå’Œconstå£°æ˜çš„å˜é‡ä½œç”¨åŸŸæ˜¯å—çº§åˆ«çš„ï¼ˆå¯ä»¥æ˜¯å‡½æ•°ã€èŠ±æ‹¬å·æˆ–æ¨¡å—ï¼‰

```js
// var - å‡½æ•°ä½œç”¨åŸŸ
function test() {
  if (true) {
    var a = 1
  }
  console.log(a) // 1ï¼Œå¯ä»¥è®¿é—®
}

// let - å—çº§ä½œç”¨åŸŸ
function test2() {
  if (true) {
    let b = 2
  }
  console.log(b) // æŠ¥é”™ï¼šb is not defined
}
```

2. **å˜é‡æå‡ä¸åŒ**
   - varå£°æ˜çš„å˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰è®¿é—®ï¼Œå€¼ä¸ºundefined
   - letå’Œconstå£°æ˜çš„å˜é‡åœ¨å£°æ˜ä¹‹å‰è®¿é—®ä¼šæŠ›å‡ºReferenceError

```js
console.log(a) // undefined
var a = 10

console.log(b) // æŠ¥é”™ï¼šCannot access 'b' before initialization
let b = 20
```

3. **é‡å¤å£°æ˜**
   - varå£°æ˜çš„å˜é‡å¯ä»¥è¢«é‡å¤å£°æ˜
   - letå’Œconstå£°æ˜çš„å˜é‡ä¸å…è®¸é‡å¤å£°æ˜

```js
var a = 1
var a = 2 // æ­£å¸¸

let b = 1
let b = 2 // æŠ¥é”™ï¼šIdentifier 'b' has already been declared
```

4. **é‡æ–°èµ‹å€¼**
   - varå’Œletå£°æ˜çš„å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼
   - constå£°æ˜çš„å˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œå…¶å€¼ä¸èƒ½è¢«é‡æ–°èµ‹å€¼

```js
let a = 1
a = 2 // æ­£å¸¸

const b = 1
b = 2 // æŠ¥é”™ï¼šAssignment to constant variable
```

5. **åˆå§‹åŒ–è¦æ±‚**
   - constå£°æ˜çš„å˜é‡å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œä¸èƒ½åœ¨ä¹‹åèµ‹å€¼

```js
const a // æŠ¥é”™ï¼šMissing initializer in const declaration
const b = 1 // æ­£å¸¸
```

## å˜é‡æå‡

**ä»€ä¹ˆæ˜¯å˜é‡æå‡ï¼Ÿ**

å˜é‡æå‡ï¼ˆHoistingï¼‰æ˜¯JavaScriptåœ¨ç¼–è¯‘é˜¶æ®µå°†å˜é‡å’Œå‡½æ•°å£°æ˜æå‡åˆ°ä½œç”¨åŸŸé¡¶éƒ¨çš„è¡Œä¸ºã€‚

**varçš„å˜é‡æå‡ï¼š**

```js
console.log(a) // undefined (ä¸ä¼šæŠ¥é”™)
var a = 10
console.log(a) // 10

// ç›¸å½“äºï¼š
var a
console.log(a) // undefined
a = 10
console.log(a) // 10
```

**å‡½æ•°æå‡ï¼š**

```js
// å‡½æ•°å£°æ˜ï¼šå®Œæ•´æå‡
sayHi() // 'ä½ å¥½' (å¯ä»¥åœ¨å£°æ˜å‰è°ƒç”¨)
function sayHi() {
  console.log('ä½ å¥½')
}

// å‡½æ•°è¡¨è¾¾å¼ï¼šåªæå‡å˜é‡ï¼Œä¸æå‡å‡½æ•°
// sayHello() // æŠ¥é”™ï¼šsayHello is not a function
var sayHello = function() {
  console.log('Hello')
}
sayHello() // 'Hello'

// ç›¸å½“äºï¼š
var sayHello // å˜é‡æå‡
sayHello() // undefined() æŠ¥é”™
sayHello = function() {
  console.log('Hello')
}
```

**letå’Œconstæ²¡æœ‰å˜é‡æå‡ï¼š**

```js
// console.log(a) // æŠ¥é”™ï¼šCannot access 'a' before initialization
let a = 10
console.log(a) // 10

// console.log(b) // æŠ¥é”™ï¼šCannot access 'b' before initialization
const b = 20
console.log(b) // 20
```

**å‡½æ•°ä¼˜å…ˆæå‡ï¼š**

å½“å‡½æ•°å£°æ˜å’Œå˜é‡å£°æ˜åŒåæ—¶ï¼Œå‡½æ•°å£°æ˜ä¼˜å…ˆçº§æ›´é«˜ã€‚

```js
console.log(foo) // [Function: foo]

var foo = 10
function foo() {
  console.log('foo')
}

console.log(foo) // 10

// ç›¸å½“äºï¼š
function foo() {
  console.log('foo')
}
var foo // é‡å¤å£°æ˜è¢«å¿½ç•¥
console.log(foo) // [Function: foo]
foo = 10
console.log(foo) // 10
```

## æš‚æ—¶æ€§æ­»åŒº

**ä»€ä¹ˆæ˜¯æš‚æ—¶æ€§æ­»åŒºï¼Ÿ**

æš‚æ—¶æ€§æ­»åŒºï¼ˆTemporal Dead Zoneï¼Œç®€ç§°TDZï¼‰æ˜¯æŒ‡åœ¨let/constå£°æ˜ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ï¼Œè®¿é—®ä¼šæŠ›å‡ºReferenceErroré”™è¯¯ã€‚

```js
// TDZå¼€å§‹
console.log(a) // æŠ¥é”™ï¼šCannot access 'a' before initialization
let a = 10
// TDZç»“æŸ
console.log(a) // 10
```

**ä¸ºä»€ä¹ˆä¼šæœ‰TDZï¼Ÿ**

TDZçš„è®¾è®¡æ˜¯ä¸ºäº†è®©ç¨‹åºæ›´åŠ ä¸¥è°¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ï¼Œæå‰å‘ç°é—®é¢˜ã€‚

**TDZçš„ç‰¹ç‚¹ï¼š**

1. let/constå£°æ˜çš„å˜é‡åœ¨å£°æ˜ä¹‹å‰éƒ½å¤„äºTDZä¸­
2. åœ¨TDZä¸­è®¿é—®å˜é‡ä¼šæŠ›å‡ºé”™è¯¯
3. typeofæ£€æŸ¥ä¹Ÿä¼šæŠ¥é”™

```js
// æƒ…å†µ1ï¼švarä¸å­˜åœ¨TDZ
console.log(typeof a) // 'undefined'
var a = 10

// æƒ…å†µ2ï¼šletå­˜åœ¨TDZ
console.log(typeof b) // æŠ¥é”™ï¼šCannot access 'b' before initialization
let b = 10

// æƒ…å†µ3ï¼šæœªå£°æ˜çš„å˜é‡
console.log(typeof c) // 'undefined' (ä¸ä¼šæŠ¥é”™)
```

**æ³¨æ„äº‹é¡¹ï¼š**

```js
let x = 10
{
  // TDZå¼€å§‹
  console.log(x) // æŠ¥é”™ï¼Œä¸ä¼šè®¿é—®å¤–å±‚çš„x
  let x = 20 // TDZç»“æŸ
}
```

## ä½œç”¨åŸŸé“¾

**ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸé“¾ï¼Ÿ**

ä½œç”¨åŸŸé“¾æ˜¯JavaScriptä¸­å˜é‡æŸ¥æ‰¾çš„æœºåˆ¶ã€‚å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼ŒJavaScriptå¼•æ“ä¼šæŒ‰ç…§ä½œç”¨åŸŸé“¾ä»å†…åˆ°å¤–æŸ¥æ‰¾å˜é‡ã€‚

**æŸ¥æ‰¾è§„åˆ™ï¼š**

å†…éƒ¨å‡½æ•°è®¿é—®å˜é‡æ—¶ï¼š
1. å…ˆåœ¨è‡ªèº«ä½œç”¨åŸŸæŸ¥æ‰¾å˜é‡å£°æ˜
2. å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå¾€å¤–å±‚ä½œç”¨åŸŸæŸ¥æ‰¾
3. ä¸€ç›´æŸ¥æ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸ
4. å¦‚æœæ‰¾åˆ°å¤šä¸ªåŒåå˜é‡ï¼Œé‡‡å–å°±è¿‘åŸåˆ™

```js
const a = 'global'

function outer() {
  const a = 'outer'

  function inner() {
    const a = 'inner'
    console.log(a) // 'inner' - å°±è¿‘åŸåˆ™
  }

  inner()
  console.log(a) // 'outer'
}

outer()
console.log(a) // 'global'
```

## æ‰§è¡Œä¸Šä¸‹æ–‡

**ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Ÿ**

æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰æ˜¯JavaScriptä»£ç æ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒ…å«äº†å˜é‡ã€å‡½æ•°å£°æ˜ã€ä½œç”¨åŸŸé“¾ã€thisç­‰ä¿¡æ¯ã€‚

**æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹ï¼š**

1. **å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼šé»˜è®¤çš„ã€æœ€åŸºç¡€çš„æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œåªæœ‰ä¸€ä¸ª
2. **å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼šæ¯å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡
3. **Evalæ‰§è¡Œä¸Šä¸‹æ–‡**ï¼ševalå‡½æ•°å†…éƒ¨çš„ä»£ç ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰

**æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸï¼š**

1. **åˆ›å»ºé˜¶æ®µ**
   - åˆ›å»ºå˜é‡å¯¹è±¡ï¼ˆVariable Objectï¼‰
   - å»ºç«‹ä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰
   - ç¡®å®šthisçš„æŒ‡å‘

2. **æ‰§è¡Œé˜¶æ®µ**
   - å˜é‡èµ‹å€¼
   - å‡½æ•°å¼•ç”¨
   - æ‰§è¡Œå…¶ä»–ä»£ç 

3. **é”€æ¯é˜¶æ®µ**
   - æ‰§è¡Œå®Œæ¯•åï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡è¢«å¼¹å‡ºæ‰§è¡Œæ ˆå¹¶é”€æ¯

## æ‰§è¡Œæ ˆ

**ä»€ä¹ˆæ˜¯æ‰§è¡Œæ ˆï¼Ÿ**

æ‰§è¡Œæ ˆï¼ˆExecution Stackï¼‰ï¼Œä¹Ÿå«è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰ï¼Œæ˜¯JavaScriptä¸­ç”¨äºå­˜å‚¨ä»£ç æ‰§è¡Œé¡ºåºçš„æ•°æ®ç»“æ„ã€‚

**æ‰§è¡Œæ ˆçš„ç‰¹ç‚¹ï¼š**

1. **åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰**ï¼šæœ€åæ·»åŠ çš„å‡½æ•°æœ€å…ˆæ‰§è¡Œå®Œæ¯•
2. **å•çº¿ç¨‹**ï¼šJavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
3. **æ ˆæº¢å‡º**ï¼šé€’å½’è°ƒç”¨è¿‡æ·±ä¼šå¯¼è‡´æ ˆæº¢å‡ºé”™è¯¯

**æ‰§è¡Œæµç¨‹ï¼š**

```js
function first() {
  console.log('firstå‡½æ•°å¼€å§‹')
  second()
  console.log('firstå‡½æ•°ç»“æŸ')
}

function second() {
  console.log('secondå‡½æ•°å¼€å§‹')
  third()
  console.log('secondå‡½æ•°ç»“æŸ')
}

function third() {
  console.log('thirdå‡½æ•°æ‰§è¡Œ')
}

first()

// æ‰§è¡Œæ ˆå˜åŒ–ï¼š
// 1. [first] - firstå…¥æ ˆ
// 2. [first, second] - secondå…¥æ ˆ
// 3. [first, second, third] - thirdå…¥æ ˆ
// 4. [first, second] - thirdæ‰§è¡Œå®Œå‡ºæ ˆ
// 5. [first] - secondæ‰§è¡Œå®Œå‡ºæ ˆ
// 6. [] - firstæ‰§è¡Œå®Œå‡ºæ ˆ

// è¾“å‡ºé¡ºåºï¼š
// firstå‡½æ•°å¼€å§‹
// secondå‡½æ•°å¼€å§‹
// thirdå‡½æ•°æ‰§è¡Œ
// secondå‡½æ•°ç»“æŸ
// firstå‡½æ•°ç»“æŸ
```

**æ ˆæº¢å‡ºç¤ºä¾‹ï¼š**

```js
function recursion() {
  recursion() // æ— é™é€’å½’
}

recursion() // æŠ¥é”™ï¼šMaximum call stack size exceeded
```

---

# äºŒã€å‡½æ•°ç¯‡

æœ¬ç¯‡ä»‹ç»JavaScriptä¸­å‡½æ•°çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒåŒ…æ‹¬thisæŒ‡å‘ã€call/apply/bindã€ç®­å¤´å‡½æ•°ã€é—­åŒ…ç­‰ã€‚

## thisæŒ‡å‘

thisçš„æŒ‡å‘å–å†³äºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„å®šä¹‰ä½ç½®ã€‚

**1. é»˜è®¤ç»‘å®šï¼ˆç‹¬ç«‹å‡½æ•°è°ƒç”¨ï¼‰**
åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒthisæŒ‡å‘å…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­æ˜¯windowï¼‰ï¼›åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthisæ˜¯undefinedã€‚

```js
function fn() {
  console.log(this)
}
fn() // éä¸¥æ ¼æ¨¡å¼: window, ä¸¥æ ¼æ¨¡å¼: undefined
```

**2. éšå¼ç»‘å®šï¼ˆå¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼‰**
å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼ŒthisæŒ‡å‘è¯¥å¯¹è±¡ã€‚

```js
const obj = {
  name: 'å¼ ä¸‰',
  sayName() {
    console.log(this.name)
  }
}
obj.sayName() // thisæŒ‡å‘objï¼Œè¾“å‡º"å¼ ä¸‰"
```

**3. æ˜¾å¼ç»‘å®šï¼ˆcall/apply/bindï¼‰**
é€šè¿‡callã€applyã€bindå¯ä»¥æ˜¾å¼æŒ‡å®šthisçš„æŒ‡å‘ã€‚

```js
function fn() {
  console.log(this.name)
}
const obj = { name: 'æå››' }
fn.call(obj) // thisæŒ‡å‘objï¼Œè¾“å‡º"æå››"
fn.apply(obj) // thisæŒ‡å‘objï¼Œè¾“å‡º"æå››"
const bindFn = fn.bind(obj)
bindFn() // thisæŒ‡å‘objï¼Œè¾“å‡º"æå››"
```

**4. newç»‘å®šï¼ˆæ„é€ å‡½æ•°è°ƒç”¨ï¼‰**
ä½¿ç”¨newå…³é”®å­—è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼ŒthisæŒ‡å‘æ–°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡ã€‚

```js
function Person(name) {
  this.name = name
}
const person = new Person('ç‹äº”')
console.log(person.name) // "ç‹äº”"
```

**5. ç®­å¤´å‡½æ•°**
ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œå®ƒçš„thisç»§æ‰¿è‡ªå¤–å±‚ä½œç”¨åŸŸï¼Œä¸”æ— æ³•é€šè¿‡call/apply/bindæ”¹å˜ã€‚

```js
const obj = {
  name: 'èµµå…­',
  sayName: () => {
    console.log(this.name) // thisä¸æ˜¯objï¼Œè€Œæ˜¯å¤–å±‚ä½œç”¨åŸŸçš„this
  }
}
```

**ä¼˜å…ˆçº§ï¼š** newç»‘å®š > æ˜¾å¼ç»‘å®š > éšå¼ç»‘å®š > é»˜è®¤ç»‘å®š

## callã€applyã€bindçš„åŒºåˆ«

è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½å¯ä»¥æ”¹å˜å‡½æ•°å†…éƒ¨thisçš„æŒ‡å‘ã€‚

**callï¼š**
- ç«‹å³è°ƒç”¨å‡½æ•°
- å‚æ•°é€ä¸ªä¼ é€’

```js
function greet(age, city) {
  console.log(`æˆ‘æ˜¯${this.name}ï¼Œä»Šå¹´${age}å²ï¼Œæ¥è‡ª${city}`)
}

const obj = { name: 'å¼ ä¸‰' }
greet.call(obj, 18, 'åŒ—äº¬') // 'æˆ‘æ˜¯å¼ ä¸‰ï¼Œä»Šå¹´18å²ï¼Œæ¥è‡ªåŒ—äº¬'
```

**applyï¼š**
- ç«‹å³è°ƒç”¨å‡½æ•°
- å‚æ•°ä»¥æ•°ç»„å½¢å¼ä¼ é€’

```js
greet.apply(obj, [18, 'åŒ—äº¬']) // 'æˆ‘æ˜¯å¼ ä¸‰ï¼Œä»Šå¹´18å²ï¼Œæ¥è‡ªåŒ—äº¬'
```

**bindï¼š**
- ä¸ç«‹å³è°ƒç”¨ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
- å‚æ•°é€ä¸ªä¼ é€’

```js
const boundGreet = greet.bind(obj, 18, 'åŒ—äº¬')
boundGreet() // 'æˆ‘æ˜¯å¼ ä¸‰ï¼Œä»Šå¹´18å²ï¼Œæ¥è‡ªåŒ—äº¬'
```

**åŒºåˆ«æ€»ç»“ï¼š**
- callå’Œapplyç«‹å³æ‰§è¡Œï¼Œbindè¿”å›æ–°å‡½æ•°
- callå’Œbindå‚æ•°é€ä¸ªä¼ é€’ï¼Œapplyå‚æ•°ä»¥æ•°ç»„ä¼ é€’
- bindå¯ä»¥åˆ†æ­¥ä¼ å‚ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰

## ç®­å¤´å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«

1. **è¯­æ³•æ›´ç®€æ´**
```js
// æ™®é€šå‡½æ•°
function add(a, b) {
  return a + b
}

// ç®­å¤´å‡½æ•°
const add = (a, b) => a + b
```

2. **æ²¡æœ‰è‡ªå·±çš„this**
ç®­å¤´å‡½æ•°ä¸ä¼šåˆ›å»ºè‡ªå·±çš„thisï¼Œå®ƒåªä¼šä»è‡ªå·±çš„ä½œç”¨åŸŸé“¾çš„ä¸Šä¸€å±‚ç»§æ‰¿thisã€‚

```js
const obj = {
  name: 'å¼ ä¸‰',
  sayName: function() {
    setTimeout(function() {
      console.log(this.name) // undefinedï¼ŒthisæŒ‡å‘window
    }, 100)
  },
  sayName2: function() {
    setTimeout(() => {
      console.log(this.name) // 'å¼ ä¸‰'ï¼Œthisç»§æ‰¿è‡ªå¤–å±‚
    }, 100)
  }
}
```

3. **ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°**
ç®­å¤´å‡½æ•°ä¸èƒ½ä½¿ç”¨newå…³é”®å­—è°ƒç”¨ã€‚

```js
const Person = (name) => {
  this.name = name
}
// new Person('å¼ ä¸‰') // æŠ¥é”™ï¼šPerson is not a constructor
```

4. **æ²¡æœ‰argumentså¯¹è±¡**
ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„argumentså¯¹è±¡ï¼Œä½†å¯ä»¥ä½¿ç”¨restå‚æ•°ã€‚

```js
// æ™®é€šå‡½æ•°
function fn() {
  console.log(arguments) // [1, 2, 3]
}
fn(1, 2, 3)

// ç®­å¤´å‡½æ•°
const fn2 = (...args) => {
  console.log(args) // [1, 2, 3]
}
fn2(1, 2, 3)
```

5. **ä¸èƒ½ä½¿ç”¨yieldå…³é”®å­—**
ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œGeneratorå‡½æ•°ã€‚

## é»˜è®¤å‚æ•°

ES6å…è®¸ä¸ºå‡½æ•°å‚æ•°è®¾ç½®é»˜è®¤å€¼ã€‚

```js
// åŸºæœ¬ç”¨æ³•
function greet(name = 'æ¸¸å®¢', age = 18) {
  console.log(`ä½ å¥½ï¼Œ${name}ï¼Œä»Šå¹´${age}å²`)
}
greet() // 'ä½ å¥½ï¼Œæ¸¸å®¢ï¼Œä»Šå¹´18å²'
greet('å¼ ä¸‰') // 'ä½ å¥½ï¼Œå¼ ä¸‰ï¼Œä»Šå¹´18å²'
greet('æå››', 20) // 'ä½ å¥½ï¼Œæå››ï¼Œä»Šå¹´20å²'

// é»˜è®¤å€¼å¯ä»¥æ˜¯è¡¨è¾¾å¼
function getDefaultName() {
  return 'é»˜è®¤ç”¨æˆ·'
}
function greet2(name = getDefaultName()) {
  console.log(name)
}

// é»˜è®¤å€¼å¯ä»¥å¼•ç”¨å…¶ä»–å‚æ•°
function add(x, y = x) {
  return x + y
}
add(5) // 10
```

## é—­åŒ…

**ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ**

é—­åŒ…ï¼ˆClosureï¼‰æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°ã€‚ç®€å•æ¥è¯´ï¼Œé—­åŒ…å°±æ˜¯å‡½æ•°åµŒå¥—å‡½æ•°ï¼Œå†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚

**é—­åŒ…çš„ç‰¹ç‚¹ï¼š**

1. å‡½æ•°åµŒå¥—å‡½æ•°
2. å†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡
3. å¤–éƒ¨å‡½æ•°çš„å˜é‡ä¸ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶

**åŸºæœ¬ç¤ºä¾‹ï¼š**

```js
function outer() {
  const name = 'å¼ ä¸‰'

  function inner() {
    console.log(name) // è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡
  }

  return inner
}

const fn = outer()
fn() // 'å¼ ä¸‰'
```

**é—­åŒ…çš„åº”ç”¨åœºæ™¯ï¼š**

1. **æ•°æ®ç§æœ‰åŒ–**

```js
function createCounter() {
  let count = 0 // ç§æœ‰å˜é‡

  return {
    increment() {
      count++
      return count
    },
    decrement() {
      count--
      return count
    },
    getCount() {
      return count
    }
  }
}

const counter = createCounter()
console.log(counter.increment()) // 1
console.log(counter.increment()) // 2
console.log(counter.getCount()) // 2
console.log(counter.count) // undefinedï¼Œæ— æ³•ç›´æ¥è®¿é—®
```

2. **å‡½æ•°æŸ¯é‡ŒåŒ–**

```js
function add(a) {
  return function(b) {
    return a + b
  }
}

const add5 = add(5)
console.log(add5(3)) // 8
console.log(add5(10)) // 15
```

3. **å»¶è¿Ÿæ‰§è¡Œ**

```js
function delay(fn, time) {
  return function(...args) {
    setTimeout(() => {
      fn.apply(this, args)
    }, time)
  }
}

const delayedLog = delay(console.log, 1000)
delayedLog('Hello') // 1ç§’åè¾“å‡º 'Hello'
```

4. **æ¨¡å—åŒ–**

```js
const module = (function() {
  let privateVar = 'ç§æœ‰å˜é‡'

  function privateMethod() {
    console.log('ç§æœ‰æ–¹æ³•')
  }

  return {
    publicMethod() {
      console.log('å…¬å…±æ–¹æ³•')
      privateMethod()
    },
    getPrivateVar() {
      return privateVar
    }
  }
})()

module.publicMethod() // 'å…¬å…±æ–¹æ³•' 'ç§æœ‰æ–¹æ³•'
console.log(module.getPrivateVar()) // 'ç§æœ‰å˜é‡'
console.log(module.privateVar) // undefined
```

**é—­åŒ…çš„æ³¨æ„äº‹é¡¹ï¼š**

1. **å†…å­˜æ³„æ¼**ï¼šé—­åŒ…ä¼šä½¿å¤–éƒ¨å‡½æ•°çš„å˜é‡ä¸€ç›´ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼

```js
function createClosure() {
  const largeData = new Array(1000000).fill('data')

  return function() {
    console.log(largeData[0])
  }
}

const fn = createClosure() // largeDataä¸€ç›´è¢«å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾
```

2. **å¾ªç¯ä¸­çš„é—­åŒ…é—®é¢˜**

```js
// é”™è¯¯ç¤ºä¾‹
for (var i = 0; i < 5; i++) {
  setTimeout(function() {
    console.log(i) // è¾“å‡º5ä¸ª5
  }, 100)
}

// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨let
for (let i = 0; i < 5; i++) {
  setTimeout(function() {
    console.log(i) // è¾“å‡º0, 1, 2, 3, 4
  }, 100)
}

// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨é—­åŒ…
for (var i = 0; i < 5; i++) {
  (function(j) {
    setTimeout(function() {
      console.log(j) // è¾“å‡º0, 1, 2, 3, 4
    }, 100)
  })(i)
}
```

---

# ä¸‰ã€å¯¹è±¡ç¯‡

æœ¬ç¯‡ä»‹ç»JavaScriptçš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ŒåŒ…æ‹¬newå…³é”®å­—ã€åŸå‹é“¾ã€ç»§æ‰¿ã€classç­‰ã€‚

## newå…³é”®å­—çš„æ‰§è¡Œè¿‡ç¨‹

ä½¿ç”¨`new`å…³é”®å­—è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼ŒJavaScriptä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡**
   ```js
   const obj = {}
   ```

2. **å°†æ–°å¯¹è±¡çš„`__proto__`æŒ‡å‘æ„é€ å‡½æ•°çš„`prototype`**
   ```js
   obj.__proto__ = Constructor.prototype
   ```

3. **å°†æ„é€ å‡½æ•°å†…éƒ¨çš„`this`æŒ‡å‘æ–°å¯¹è±¡**
   ```js
   Constructor.call(obj)
   ```

4. **æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œç»™æ–°å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•**
   æ„é€ å‡½æ•°å†…éƒ¨çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œæ‰€æœ‰`this.xxx`éƒ½ä¼šæ·»åŠ åˆ°æ–°å¯¹è±¡ä¸Š

5. **è¿”å›æ–°å¯¹è±¡ï¼ˆé»˜è®¤return thisï¼‰**
   - å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ–è¿”å›çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆNumberã€Stringã€Booleanç­‰ï¼‰ï¼Œåˆ™è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡
   - å¦‚æœæ„é€ å‡½æ•°è¿”å›çš„æ˜¯å¯¹è±¡ç±»å‹ï¼ˆObjectã€Arrayã€Functionç­‰ï¼‰ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ä¼šè¢«ä¸¢å¼ƒ

**ç¤ºä¾‹ï¼š**

```js
function Person(name, age) {
  this.name = name
  this.age = age
  this.sayHi = function() {
    console.log(`æˆ‘æ˜¯${this.name}`)
  }
}

const p1 = new Person('å¼ ä¸‰', 18)
console.log(p1.name) // 'å¼ ä¸‰'
console.log(p1.age) // 18
p1.sayHi() // 'æˆ‘æ˜¯å¼ ä¸‰'

// æƒ…å†µ1: è¿”å›åŸºæœ¬ç±»å‹ï¼Œä¼šè¢«å¿½ç•¥
function Person1(name) {
  this.name = name
  return 123 // è¿”å›åŸºæœ¬ç±»å‹ï¼Œä¼šè¢«å¿½ç•¥
}
const p2 = new Person1('æå››')
console.log(p2) // Person1 { name: 'æå››' }

// æƒ…å†µ2: è¿”å›å¯¹è±¡ç±»å‹ï¼Œä¼šè¦†ç›–newåˆ›å»ºçš„å¯¹è±¡
function Person2(name) {
  this.name = name
  return { age: 20 } // è¿”å›å¯¹è±¡ç±»å‹
}
const p3 = new Person2('ç‹äº”')
console.log(p3) // { age: 20 }ï¼Œnameå±æ€§ä¸¢å¤±
```

## åŸå‹é“¾

æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª`__proto__`å±æ€§ï¼ŒæŒ‡å‘å…¶æ„é€ å‡½æ•°çš„`prototype`å¯¹è±¡ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€æ¡åŸå‹é“¾ã€‚

```js
function Person(name) {
  this.name = name
}

Person.prototype.sayHi = function() {
  console.log(`æˆ‘æ˜¯${this.name}`)
}

const p = new Person('å¼ ä¸‰')

// åŸå‹é“¾ï¼šp -> Person.prototype -> Object.prototype -> null
console.log(p.__proto__ === Person.prototype) // true
console.log(Person.prototype.__proto__ === Object.prototype) // true
console.log(Object.prototype.__proto__) // null
```

**åŸå‹é“¾çš„ä½œç”¨ï¼š**
- å®ç°ç»§æ‰¿
- å®ç°å±æ€§å’Œæ–¹æ³•çš„å…±äº«

**å±æ€§æŸ¥æ‰¾è§„åˆ™ï¼š**
1. å…ˆåœ¨å¯¹è±¡è‡ªèº«æŸ¥æ‰¾
2. å¦‚æœæ²¡æœ‰ï¼Œæ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾
3. ç›´åˆ°æ‰¾åˆ°æˆ–åˆ°è¾¾åŸå‹é“¾é¡¶ç«¯ï¼ˆnullï¼‰

## ç»§æ‰¿

JavaScriptä¸­å®ç°ç»§æ‰¿çš„å‡ ç§æ–¹å¼ï¼š

**1. åŸå‹é“¾ç»§æ‰¿**

```js
function Parent() {
  this.name = 'çˆ¶ç±»'
}

Parent.prototype.getName = function() {
  return this.name
}

function Child() {}

Child.prototype = new Parent()

const child = new Child()
console.log(child.getName()) // 'çˆ¶ç±»'
```

**ç¼ºç‚¹ï¼š**
- æ‰€æœ‰å®ä¾‹å…±äº«çˆ¶ç±»çš„å¼•ç”¨ç±»å‹å±æ€§
- æ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚

**2. æ„é€ å‡½æ•°ç»§æ‰¿**

```js
function Parent(name) {
  this.name = name
}

function Child(name) {
  Parent.call(this, name)
}

const child = new Child('å­ç±»')
console.log(child.name) // 'å­ç±»'
```

**ç¼ºç‚¹ï¼š**
- æ— æ³•ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„æ–¹æ³•
- æ¯æ¬¡åˆ›å»ºå®ä¾‹éƒ½ä¼šåˆ›å»ºä¸€éæ–¹æ³•

**3. ç»„åˆç»§æ‰¿ï¼ˆæœ€å¸¸ç”¨ï¼‰**

```js
function Parent(name) {
  this.name = name
}

Parent.prototype.getName = function() {
  return this.name
}

function Child(name, age) {
  Parent.call(this, name) // ç»§æ‰¿å±æ€§
  this.age = age
}

Child.prototype = new Parent() // ç»§æ‰¿æ–¹æ³•
Child.prototype.constructor = Child

const child = new Child('å¼ ä¸‰', 18)
console.log(child.getName()) // 'å¼ ä¸‰'
console.log(child.age) // 18
```

**4. ES6 classç»§æ‰¿**

```js
class Parent {
  constructor(name) {
    this.name = name
  }

  getName() {
    return this.name
  }
}

class Child extends Parent {
  constructor(name, age) {
    super(name)
    this.age = age
  }
}

const child = new Child('å¼ ä¸‰', 18)
console.log(child.getName()) // 'å¼ ä¸‰'
```

## classç±»

ES6å¼•å…¥äº†classå…³é”®å­—ï¼Œä½¿å¾—é¢å‘å¯¹è±¡ç¼–ç¨‹æ›´åŠ æ¸…æ™°ã€‚

```js
// åŸºæœ¬ç”¨æ³•
class Person {
  constructor(name, age) {
    this.name = name
    this.age = age
  }

  sayHi() {
    console.log(`æˆ‘æ˜¯${this.name}`)
  }

  static create(name, age) {
    return new Person(name, age)
  }
}

const p = new Person('å¼ ä¸‰', 18)
p.sayHi() // 'æˆ‘æ˜¯å¼ ä¸‰'

// ç±»çš„ç»§æ‰¿
class Student extends Person {
  constructor(name, age, grade) {
    super(name, age)
    this.grade = grade
  }

  sayHi() {
    console.log(`æˆ‘æ˜¯${this.name}ï¼Œæˆ‘åœ¨${this.grade}å¹´çº§`)
  }
}

const s = new Student('å°æ˜', 15, 3)
s.sayHi() // 'æˆ‘æ˜¯å°æ˜ï¼Œæˆ‘åœ¨3å¹´çº§'
```

---

# å››ã€å¼‚æ­¥ç¯‡

æœ¬ç¯‡ä»‹ç»JavaScriptçš„å¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ï¼ŒåŒ…æ‹¬å›è°ƒå‡½æ•°ã€Promiseã€async/awaitã€äº‹ä»¶å¾ªç¯ç­‰ã€‚

## å›è°ƒå‡½æ•°

**ä»€ä¹ˆæ˜¯å›è°ƒå‡½æ•°ï¼Ÿ**

å›è°ƒå‡½æ•°æ˜¯æŠŠä»»åŠ¡çš„ç¬¬äºŒæ®µå•ç‹¬å†™åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç­‰åˆ°é‡æ–°æ‰§è¡Œè¿™ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

```js
// åŸºæœ¬ç¤ºä¾‹
fs.readFile('/etc/passwd', function (err, data) {
  if (err) throw err
  console.log(data)
})

// å›è°ƒå‡½æ•°ç¤ºä¾‹
function fetchData(callback) {
  setTimeout(() => {
    const data = { name: 'å¼ ä¸‰', age: 18 }
    callback(data)
  }, 1000)
}

fetchData((data) => {
  console.log('è·å–åˆ°æ•°æ®:', data)
})
```

**å›è°ƒåœ°ç‹±é—®é¢˜ï¼š**

å½“å¤šä¸ªå¼‚æ­¥æ“ä½œå­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œä¼šå½¢æˆå›è°ƒåœ°ç‹±ï¼ˆCallback Hellï¼‰ï¼Œä»£ç éš¾ä»¥ç»´æŠ¤ã€‚

```js
// å›è°ƒåœ°ç‹±ç¤ºä¾‹
getData1((data1) => {
  getData2(data1, (data2) => {
    getData3(data2, (data3) => {
      getData4(data3, (data4) => {
        console.log('æœ€ç»ˆç»“æœ:', data4)
      })
    })
  })
})
```

## Promise

Promiseæ˜¯ES6æ–°å¢çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œä½¿å¼‚æ­¥ä»£ç æ›´åŠ ä¼˜é›…ã€‚

**Promiseçš„ä¸‰ç§çŠ¶æ€ï¼š**
- **pendingï¼ˆè¿›è¡Œä¸­ï¼‰**ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸä¹Ÿä¸æ˜¯å¤±è´¥
- **fulfilledï¼ˆå·²æˆåŠŸï¼‰**ï¼šæ“ä½œæˆåŠŸå®Œæˆ
- **rejectedï¼ˆå·²å¤±è´¥ï¼‰**ï¼šæ“ä½œå¤±è´¥

çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸ä¼šå†å˜ï¼Œåªèƒ½ä»pendingå˜ä¸ºfulfilledæˆ–ä»pendingå˜ä¸ºrejectedã€‚

**åŸºæœ¬ç”¨æ³•ï¼š**

```js
// åˆ›å»ºPromise
const promise = new Promise((resolve, reject) => {
  // å¼‚æ­¥æ“ä½œ
  setTimeout(() => {
    const success = true
    if (success) {
      resolve('æˆåŠŸçš„ç»“æœ') // å°†çŠ¶æ€æ”¹ä¸ºfulfilled
    } else {
      reject('å¤±è´¥çš„åŸå› ') // å°†çŠ¶æ€æ”¹ä¸ºrejected
    }
  }, 1000)
})

// ä½¿ç”¨Promise
promise
  .then(result => {
    console.log(result) // 'æˆåŠŸçš„ç»“æœ'
    return result + ' å¤„ç†å'
  })
  .then(result => {
    console.log(result) // 'æˆåŠŸçš„ç»“æœ å¤„ç†å'
  })
  .catch(error => {
    console.log('æ•è·é”™è¯¯:', error)
  })
  .finally(() => {
    console.log('æ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œ')
  })
```

**Promiseé“¾å¼è°ƒç”¨ï¼š**

```js
// è§£å†³å›è°ƒåœ°ç‹±
getData1()
  .then(data1 => getData2(data1))
  .then(data2 => getData3(data2))
  .then(data3 => getData4(data3))
  .then(data4 => {
    console.log('æœ€ç»ˆç»“æœ:', data4)
  })
  .catch(error => {
    console.log('ä»»ä½•ä¸€æ­¥å‡ºé”™éƒ½ä¼šè¢«æ•è·:', error)
  })
```

**Promiseçš„é™æ€æ–¹æ³•ï¼š**

```js
// 1. Promise.all() - æ‰€æœ‰Promiseéƒ½æˆåŠŸæ‰æˆåŠŸ
const p1 = Promise.resolve(1)
const p2 = Promise.resolve(2)
const p3 = Promise.resolve(3)

Promise.all([p1, p2, p3]).then(results => {
  console.log(results) // [1, 2, 3]
})

// åªè¦æœ‰ä¸€ä¸ªå¤±è´¥ï¼Œå°±ä¼šç«‹å³reject
const p4 = Promise.reject('é”™è¯¯')
Promise.all([p1, p2, p4]).catch(error => {
  console.log(error) // 'é”™è¯¯'
})

// 2. Promise.race() - è¿”å›æœ€å…ˆå®Œæˆçš„Promiseç»“æœ
const p5 = new Promise(resolve => setTimeout(() => resolve('æ…¢'), 1000))
const p6 = new Promise(resolve => setTimeout(() => resolve('å¿«'), 100))

Promise.race([p5, p6]).then(result => {
  console.log(result) // 'å¿«'
})

// 3. Promise.allSettled() - ç­‰å¾…æ‰€æœ‰Promiseå®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰
const p7 = Promise.resolve(1)
const p8 = Promise.reject('é”™è¯¯')
const p9 = Promise.resolve(3)

Promise.allSettled([p7, p8, p9]).then(results => {
  console.log(results)
  // [
  //   { status: 'fulfilled', value: 1 },
  //   { status: 'rejected', reason: 'é”™è¯¯' },
  //   { status: 'fulfilled', value: 3 }
  // ]
})

// 4. Promise.any() - è¿”å›ç¬¬ä¸€ä¸ªæˆåŠŸçš„Promise
const p10 = Promise.reject('é”™è¯¯1')
const p11 = Promise.reject('é”™è¯¯2')
const p12 = Promise.resolve('æˆåŠŸ')

Promise.any([p10, p11, p12]).then(result => {
  console.log(result) // 'æˆåŠŸ'
})

// å¦‚æœæ‰€æœ‰Promiseéƒ½å¤±è´¥ï¼Œè¿”å›AggregateError
Promise.any([p10, p11]).catch(error => {
  console.log(error) // AggregateError: All promises were rejected
})

// 5. Promise.resolve() - å°†å€¼è½¬æ¢ä¸ºPromise
Promise.resolve('hello').then(value => {
  console.log(value) // 'hello'
})

// 6. Promise.reject() - è¿”å›ä¸€ä¸ªrejectedçŠ¶æ€çš„Promise
Promise.reject('é”™è¯¯').catch(error => {
  console.log(error) // 'é”™è¯¯'
})
```

## async/await

async/awaitæ˜¯ES2017å¼•å…¥çš„è¯­æ³•ç³–ï¼ŒåŸºäºPromiseå®ç°ï¼Œä½¿å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ï¼Œæ›´åŠ ç›´è§‚æ˜“è¯»ã€‚

**åŸºæœ¬ç”¨æ³•ï¼š**

```js
// asyncå‡½æ•°æ€»æ˜¯è¿”å›Promise
async function getData() {
  return 'æ•°æ®' // ç›¸å½“äº return Promise.resolve('æ•°æ®')
}

getData().then(data => console.log(data)) // 'æ•°æ®'

// awaitç­‰å¾…Promiseå®Œæˆ
async function fetchData() {
  const promise = new Promise(resolve => {
    setTimeout(() => resolve('å¼‚æ­¥æ•°æ®'), 1000)
  })

  const result = await promise // ç­‰å¾…Promiseå®Œæˆ
  console.log(result) // 'å¼‚æ­¥æ•°æ®'
  return result
}

fetchData()
```

**é”™è¯¯å¤„ç†ï¼š**

```js
// ä½¿ç”¨try-catchæ•è·é”™è¯¯
async function fetchDataWithError() {
  try {
    const result = await Promise.reject('å‡ºé”™äº†')
    console.log(result)
  } catch (error) {
    console.log('æ•è·åˆ°é”™è¯¯:', error) // 'æ•è·åˆ°é”™è¯¯: å‡ºé”™äº†'
  }
}

// ä¸ä½¿ç”¨try-catchï¼Œé”™è¯¯ä¼šè¢«è¿”å›çš„Promiseæ•è·
async function fetchData2() {
  const result = await Promise.reject('å‡ºé”™äº†')
  return result
}

fetchData2().catch(error => {
  console.log('Promiseæ•è·é”™è¯¯:', error)
})
```

**å¹¶å‘æ‰§è¡Œï¼š**

```js
// ä¸²è¡Œæ‰§è¡Œï¼ˆè€—æ—¶é•¿ï¼‰
async function serial() {
  const result1 = await fetch('/api/1') // ç­‰å¾…1ç§’
  const result2 = await fetch('/api/2') // ç­‰å¾…1ç§’
  const result3 = await fetch('/api/3') // ç­‰å¾…1ç§’
  // æ€»è€—æ—¶: 3ç§’
}

// å¹¶å‘æ‰§è¡Œï¼ˆè€—æ—¶çŸ­ï¼‰
async function parallel() {
  const [result1, result2, result3] = await Promise.all([
    fetch('/api/1'),
    fetch('/api/2'),
    fetch('/api/3')
  ])
  // æ€»è€—æ—¶: 1ç§’ï¼ˆåŒæ—¶å‘èµ·è¯·æ±‚ï¼‰
}

// ä½¿ç”¨Promise.allå¹¶å‘
async function fetchMultiple() {
  const urls = ['/api/1', '/api/2', '/api/3']
  const promises = urls.map(url => fetch(url))
  const results = await Promise.all(promises)
  return results
}
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**

```js
// é¡ºåºè·å–ç”¨æˆ·ä¿¡æ¯å’Œè®¢å•ä¿¡æ¯
async function getUserData(userId) {
  try {
    // 1. è·å–ç”¨æˆ·ä¿¡æ¯
    const user = await fetch(`/api/users/${userId}`).then(res => res.json())
    console.log('ç”¨æˆ·ä¿¡æ¯:', user)

    // 2. æ ¹æ®ç”¨æˆ·IDè·å–è®¢å•
    const orders = await fetch(`/api/orders?userId=${userId}`).then(res => res.json())
    console.log('è®¢å•ä¿¡æ¯:', orders)

    // 3. è¿”å›å®Œæ•´æ•°æ®
    return { user, orders }
  } catch (error) {
    console.error('è·å–æ•°æ®å¤±è´¥:', error)
    throw error
  }
}

// ä½¿ç”¨
getUserData(123).then(data => {
  console.log('å®Œæ•´æ•°æ®:', data)
})
```

**async/await vs Promiseï¼š**

```js
// Promiseå†™æ³•
function getDataPromise() {
  return fetch('/api/data')
    .then(response => response.json())
    .then(data => {
      console.log(data)
      return data
    })
    .catch(error => {
      console.error(error)
    })
}

// async/awaitå†™æ³•ï¼ˆæ›´æ¸…æ™°ï¼‰
async function getDataAsync() {
  try {
    const response = await fetch('/api/data')
    const data = await response.json()
    console.log(data)
    return data
  } catch (error) {
    console.error(error)
  }
}
```

## äº‹ä»¶å¾ªç¯

JavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œé€šè¿‡äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰æœºåˆ¶æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚

**æ‰§è¡Œæµç¨‹ï¼š**
1. åŒæ­¥ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆæ‰§è¡Œæ ˆ
2. å¼‚æ­¥ä»»åŠ¡çš„å›è°ƒå‡½æ•°æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—
3. æ‰§è¡Œæ ˆæ¸…ç©ºåï¼Œè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å›è°ƒå‡½æ•°å‹å…¥æ‰§è¡Œæ ˆæ‰§è¡Œ
4. é‡å¤ä»¥ä¸Šæ­¥éª¤

## å®ä»»åŠ¡&å¾®ä»»åŠ¡

**å®ä»»åŠ¡ï¼ˆMacro Taskï¼‰ï¼š**
- setTimeout
- setInterval
- setImmediateï¼ˆNode.jsï¼‰
- I/Oæ“ä½œ
- UIæ¸²æŸ“

**å¾®ä»»åŠ¡ï¼ˆMicro Taskï¼‰ï¼š**
- Promise.then/catch/finally
- async/await
- MutationObserver
- process.nextTickï¼ˆNode.jsï¼‰

**æ‰§è¡Œé¡ºåºï¼š**
1. æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡
2. æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡
3. æ¸²æŸ“ï¼ˆå¦‚æœéœ€è¦ï¼‰
4. æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡

**ç¤ºä¾‹ä»£ç ï¼š**

```js
console.log('1') // åŒæ­¥ä»»åŠ¡

setTimeout(() => {
  console.log('2') // å®ä»»åŠ¡
}, 0)

Promise.resolve().then(() => {
  console.log('3') // å¾®ä»»åŠ¡
})

console.log('4') // åŒæ­¥ä»»åŠ¡

// è¾“å‡ºé¡ºåºï¼š1 4 3 2
// è§£é‡Šï¼š
// 1. æ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼š1, 4
// 2. æ‰§è¡Œå¾®ä»»åŠ¡ï¼š3
// 3. æ‰§è¡Œå®ä»»åŠ¡ï¼š2
```

**å¤æ‚ç¤ºä¾‹ï¼š**

```js
console.log('start')

setTimeout(() => {
  console.log('setTimeout1')
  Promise.resolve().then(() => {
    console.log('promise1')
  })
}, 0)

Promise.resolve().then(() => {
  console.log('promise2')
  setTimeout(() => {
    console.log('setTimeout2')
  }, 0)
})

console.log('end')

// è¾“å‡ºé¡ºåºï¼šstart end promise2 setTimeout1 promise1 setTimeout2
```

---

# äº”ã€ES6+ç¯‡

æœ¬ç¯‡ä»‹ç»ES6åŠä¹‹åç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬let/constã€è§£æ„èµ‹å€¼ã€æ¨¡æ¿å­—ç¬¦ä¸²ã€Set/Mapç­‰ã€‚

## let const

**varã€letã€constçš„åŒºåˆ«ï¼š**

1. **ä½œç”¨åŸŸä¸åŒ**
   - varå£°æ˜çš„å˜é‡ä½œç”¨åŸŸæ˜¯å‡½æ•°çº§åˆ«çš„
   - letå’Œconstå£°æ˜çš„å˜é‡ä½œç”¨åŸŸæ˜¯å—çº§åˆ«çš„

2. **å˜é‡æå‡**
   - varå£°æ˜çš„å˜é‡å¯ä»¥åœ¨å£°æ˜ä¹‹å‰è®¿é—®ï¼Œå€¼ä¸ºundefined
   - letå’Œconstå£°æ˜çš„å˜é‡åœ¨å£°æ˜ä¹‹å‰è®¿é—®ä¼šæŠ›å‡ºReferenceError

3. **é‡å¤å£°æ˜**
   - varå£°æ˜çš„å˜é‡å¯ä»¥è¢«é‡å¤å£°æ˜
   - letå’Œconstå£°æ˜çš„å˜é‡ä¸å…è®¸é‡å¤å£°æ˜

4. **é‡æ–°èµ‹å€¼**
   - letå£°æ˜çš„å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼
   - constå£°æ˜çš„å˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œå…¶å€¼ä¸èƒ½è¢«é‡æ–°èµ‹å€¼

5. **åˆå§‹åŒ–è¦æ±‚**
   - constå£°æ˜çš„å˜é‡å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ [å˜é‡å£°æ˜](#å˜é‡å£°æ˜) ç« èŠ‚ã€‚

## Set&Map

**Set**

Setæ˜¯ES6æ–°å¢çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºæ•°ç»„ï¼Œä½†æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚

```js
// åˆ›å»ºSet
const set = new Set([1, 2, 3, 3, 4])
console.log(set) // Set(4) {1, 2, 3, 4}

// å¸¸ç”¨æ–¹æ³•
set.add(5) // æ·»åŠ å…ƒç´ 
set.delete(2) // åˆ é™¤å…ƒç´ 
set.has(3) // åˆ¤æ–­æ˜¯å¦åŒ…å«æŸå…ƒç´ 
set.clear() // æ¸…ç©º
set.size // è·å–å…ƒç´ ä¸ªæ•°

// éå†æ–¹æ³•
set.forEach(value => console.log(value))
for (let item of set) {
  console.log(item)
}

// åº”ç”¨ï¼šæ•°ç»„å»é‡
const arr = [1, 2, 2, 3, 3, 4]
const uniqueArr = [...new Set(arr)] // [1, 2, 3, 4]
```

**Map**

Mapæ˜¯ES6æ–°å¢çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºå¯¹è±¡ï¼Œä½†é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ã€‚

```js
// åˆ›å»ºMap
const map = new Map()

// å¸¸ç”¨æ–¹æ³•
map.set('name', 'å¼ ä¸‰') // è®¾ç½®é”®å€¼å¯¹
map.set(123, 'æ•°å­—é”®')
map.set({}, 'å¯¹è±¡é”®')
map.get('name') // 'å¼ ä¸‰' è·å–å€¼
map.has('name') // true åˆ¤æ–­æ˜¯å¦åŒ…å«æŸé”®
map.delete('name') // åˆ é™¤é”®å€¼å¯¹
map.clear() // æ¸…ç©º
map.size // è·å–é”®å€¼å¯¹ä¸ªæ•°

// éå†æ–¹æ³•
map.forEach((value, key) => console.log(key, value))
for (let [key, value] of map) {
  console.log(key, value)
}
```

**Setå’ŒMapçš„åŒºåˆ«ï¼š**
- Setæ˜¯å€¼çš„é›†åˆï¼ŒMapæ˜¯é”®å€¼å¯¹çš„é›†åˆ
- Setçš„å€¼æ˜¯å”¯ä¸€çš„ï¼ŒMapçš„é”®æ˜¯å”¯ä¸€çš„
- Setç”¨äºæ•°ç»„å»é‡ï¼ŒMapç”¨äºå­˜å‚¨é”®å€¼å¯¹

## è§£æ„èµ‹å€¼

è§£æ„èµ‹å€¼æ˜¯ES6æ–°å¢çš„è¯­æ³•ï¼Œå¯ä»¥ä»æ•°ç»„æˆ–å¯¹è±¡ä¸­æå–å€¼ï¼Œèµ‹ç»™å˜é‡ã€‚

**æ•°ç»„è§£æ„ï¼š**

```js
// åŸºæœ¬ç”¨æ³•
const [a, b, c] = [1, 2, 3]
console.log(a, b, c) // 1 2 3

// è·³è¿‡æŸäº›å€¼
const [x, , z] = [1, 2, 3]
console.log(x, z) // 1 3

// å‰©ä½™è¿ç®—ç¬¦
const [first, ...rest] = [1, 2, 3, 4, 5]
console.log(first) // 1
console.log(rest) // [2, 3, 4, 5]

// é»˜è®¤å€¼
const [a, b, c = 3] = [1, 2]
console.log(c) // 3

// äº¤æ¢å˜é‡
let m = 1, n = 2;
[m, n] = [n, m]
console.log(m, n) // 2 1
```

**å¯¹è±¡è§£æ„ï¼š**

```js
// åŸºæœ¬ç”¨æ³•
const { name, age } = { name: 'å¼ ä¸‰', age: 18 }
console.log(name, age) // 'å¼ ä¸‰' 18

// é‡å‘½å
const { name: userName, age: userAge } = { name: 'æå››', age: 20 }
console.log(userName, userAge) // 'æå››' 20

// é»˜è®¤å€¼
const { name, age, gender = 'ç”·' } = { name: 'ç‹äº”', age: 22 }
console.log(gender) // 'ç”·'

// åµŒå¥—è§£æ„
const user = {
  name: 'èµµå…­',
  info: {
    age: 25,
    address: 'åŒ—äº¬'
  }
}
const { name, info: { age, address } } = user
console.log(name, age, address) // 'èµµå…­' 25 'åŒ—äº¬'

// å‡½æ•°å‚æ•°è§£æ„
function greet({ name, age }) {
  console.log(`æˆ‘æ˜¯${name}ï¼Œä»Šå¹´${age}å²`)
}
greet({ name: 'å°æ˜', age: 18 }) // 'æˆ‘æ˜¯å°æ˜ï¼Œä»Šå¹´18å²'
```

**å­—ç¬¦ä¸²è§£æ„ï¼š**

```js
const [a, b, c] = 'hello'
console.log(a, b, c) // 'h' 'e' 'l'
```

## æ¨¡æ¿å­—ç¬¦ä¸²

æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨åå¼•å·ï¼ˆ\`ï¼‰åŒ…è£¹ï¼Œå¯ä»¥åŒ…å«å ä½ç¬¦`${}`ã€‚

```js
// åŸºæœ¬ç”¨æ³•
const name = 'å¼ ä¸‰'
const age = 18
console.log(`æˆ‘æ˜¯${name}ï¼Œä»Šå¹´${age}å²`) // 'æˆ‘æ˜¯å¼ ä¸‰ï¼Œä»Šå¹´18å²'

// å¤šè¡Œå­—ç¬¦ä¸²
const message = `
  ç¬¬ä¸€è¡Œ
  ç¬¬äºŒè¡Œ
  ç¬¬ä¸‰è¡Œ
`

// è¡¨è¾¾å¼è®¡ç®—
const a = 10, b = 20
console.log(`${a} + ${b} = ${a + b}`) // '10 + 20 = 30'

// è°ƒç”¨å‡½æ•°
function upper(str) {
  return str.toUpperCase()
}
console.log(`Hello ${upper('world')}`) // 'Hello WORLD'
```

## æ‰©å±•è¿ç®—ç¬¦

æ‰©å±•è¿ç®—ç¬¦ï¼ˆ...ï¼‰å¯ä»¥å°†æ•°ç»„æˆ–å¯¹è±¡å±•å¼€ã€‚

```js
// æ•°ç»„æ‰©å±•
const arr1 = [1, 2, 3]
const arr2 = [...arr1, 4, 5, 6] // [1, 2, 3, 4, 5, 6]

// æ•°ç»„åˆå¹¶
const arr3 = [1, 2]
const arr4 = [3, 4]
const merged = [...arr3, ...arr4] // [1, 2, 3, 4]

// æ•°ç»„æ‹·è´
const original = [1, 2, 3]
const copy = [...original] // [1, 2, 3]

// å¯¹è±¡æ‰©å±•
const obj1 = { a: 1, b: 2 }
const obj2 = { ...obj1, c: 3 } // { a: 1, b: 2, c: 3 }

// å¯¹è±¡åˆå¹¶
const obj3 = { a: 1 }
const obj4 = { b: 2 }
const mergedObj = { ...obj3, ...obj4 } // { a: 1, b: 2 }

// å‡½æ•°å‚æ•°
function sum(...numbers) {
  return numbers.reduce((acc, cur) => acc + cur, 0)
}
sum(1, 2, 3, 4, 5) // 15
```

## for in & for of

**for...in**ï¼šéå†å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼ˆåŒ…æ‹¬åŸå‹é“¾ä¸Šçš„å±æ€§ï¼‰

```js
const obj = { a: 1, b: 2, c: 3 }
for (let key in obj) {
  console.log(key, obj[key]) // a 1, b 2, c 3
}
```

**for...of**ï¼šéå†å¯è¿­ä»£å¯¹è±¡çš„å€¼ï¼ˆæ•°ç»„ã€å­—ç¬¦ä¸²ã€Mapã€Setç­‰ï¼‰

```js
const arr = [1, 2, 3]
for (let value of arr) {
  console.log(value) // 1, 2, 3
}
```

**åŒºåˆ«ï¼š**
- for...inéå†çš„æ˜¯é”®åï¼Œfor...oféå†çš„æ˜¯é”®å€¼
- for...inå¯ä»¥éå†å¯¹è±¡ï¼Œfor...ofä¸èƒ½éå†æ™®é€šå¯¹è±¡
- for...ofå¯ä»¥ä½¿ç”¨breakã€continueã€return

---

# å…­ã€å¸¸ç”¨APIç¯‡

æœ¬ç¯‡æ•´ç†äº†JavaScriptä¸­å¸¸ç”¨çš„æ•°ç»„ã€å­—ç¬¦ä¸²ã€å¯¹è±¡æ–¹æ³•ã€‚

## æ•°ç»„çš„å¸¸ç”¨æ–¹æ³•æœ‰å“ªäº›?

**æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼š**

- `push()`ï¼šå°†å‚æ•°æ·»åŠ åˆ°åŸæ•°ç»„æœ«å°¾ï¼Œå¹¶è¿”å›æ•°ç»„çš„é•¿åº¦
- `pop()`ï¼šåˆ é™¤åŸæ•°ç»„æœ€åä¸€é¡¹ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ çš„å€¼ï¼›å¦‚æœæ•°ç»„ä¸ºç©ºåˆ™è¿”å›undefined
- `shift()`ï¼šåˆ é™¤åŸæ•°ç»„ç¬¬ä¸€é¡¹ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ çš„å€¼ï¼›å¦‚æœæ•°ç»„ä¸ºç©ºåˆ™è¿”å›undefined
- `unshift()`ï¼šå°†å‚æ•°æ·»åŠ åˆ°åŸæ•°ç»„å¼€å¤´ï¼Œå¹¶è¿”å›æ•°ç»„çš„é•¿åº¦
- `splice(start, deleteCount, val1, val2, ...)`ï¼šä»startä½ç½®å¼€å§‹åˆ é™¤deleteCounté¡¹ï¼Œå¹¶ä»è¯¥ä½ç½®èµ·æ’å…¥æ–°å…ƒç´ 
- `sort(compareFunction)`ï¼šæŒ‰æŒ‡å®šçš„å‚æ•°å¯¹æ•°ç»„è¿›è¡Œæ’åº
- `reverse()`ï¼šå°†æ•°ç»„ååº
- `fill(value, start, end)`ï¼šä½¿ç”¨ç‰¹å®šå€¼å¡«å……æ•°ç»„ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ 
- `copyWithin(target, start, end)`ï¼šä»æ•°ç»„çš„æŒ‡å®šä½ç½®æ‹·è´å…ƒç´ åˆ°æ•°ç»„çš„å¦ä¸€ä¸ªæŒ‡å®šä½ç½®ä¸­

**ä¸æ”¹å˜åŸæ•°ç»„çš„æ–¹æ³•ï¼š**

- `join(separator)`ï¼šå°†æ•°ç»„çš„å…ƒç´ ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥separatorä¸ºåˆ†éš”ç¬¦ï¼Œçœç•¥çš„è¯åˆ™ç”¨é»˜è®¤ç”¨é€—å·ä¸ºåˆ†éš”ç¬¦
- `slice(start, end)`ï¼šæˆªå–æ•°ç»„æŸéƒ¨åˆ†çš„å…ƒç´ ä¸ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èµ·å§‹ä½ç½®ï¼Œç¬¬äºŒä¸ªæ˜¯ç»“æŸä½ç½®(ä¸åŒ…å«end)
- `concat()`ï¼šå°†ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„åˆå¹¶åœ¨ä¸€èµ·ï¼Œè¿”å›æ–°æ•°ç»„
- `indexOf(value)`ï¼šè¿”å›å½“å‰å€¼åœ¨æ•°ç»„ä¸­ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®çš„ç´¢å¼•ï¼Œæ²¡æœ‰åˆ™è¿”å›-1
- `lastIndexOf(value)`ï¼šè¿”å›å½“å‰å€¼åœ¨æ•°ç»„ä¸­æœ€åå‡ºç°ä½ç½®çš„ç´¢å¼•ï¼Œæ²¡æœ‰åˆ™è¿”å›-1
- `includes(value)`ï¼šåˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«æŒ‡å®šçš„å€¼ï¼Œè¿”å›å¸ƒå°”å€¼
- `toString()`ã€`toLocaleString()`ï¼šå°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²

**éå†æ–¹æ³•ï¼š**

- `forEach(callback)`ï¼šå¾ªç¯éå†æ•°ç»„æ¯ä¸€é¡¹ï¼Œæ²¡æœ‰è¿”å›å€¼
- `map(callback)`ï¼šå¾ªç¯éå†æ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œè¿”å›æ–°æ•°ç»„
- `filter(callback)`ï¼šè¿‡æ»¤æ•°ç»„ï¼Œè¿”å›æ»¡è¶³æ¡ä»¶çš„æ–°æ•°ç»„
- `find(callback)`ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å€¼ï¼Œå¹¶åœæ­¢æŸ¥æ‰¾
- `findIndex(callback)`ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å€¼çš„ç´¢å¼•ï¼Œå¹¶åœæ­¢æŸ¥æ‰¾
- `every(callback)`ï¼šåˆ¤æ–­æ•°ç»„ä¸­æ¯ä¸€é¡¹æ˜¯å¦éƒ½ç¬¦åˆæ¡ä»¶ï¼Œè¿”å›å¸ƒå°”å€¼
- `some(callback)`ï¼šåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„é¡¹ï¼Œè¿”å›å¸ƒå°”å€¼
- `reduce(callback, initialValue)`ï¼šå°†æ•°ç»„å…ƒç´ ç´¯åŠ ä¸ºä¸€ä¸ªå€¼ï¼ˆä»å·¦åˆ°å³ï¼‰
- `reduceRight(callback, initialValue)`ï¼šå°†æ•°ç»„å…ƒç´ ç´¯åŠ ä¸ºä¸€ä¸ªå€¼ï¼ˆä»å³åˆ°å·¦ï¼‰

**å…¶ä»–æ–¹æ³•ï¼š**

- `flat(depth)`ï¼šå°†åµŒå¥—æ•°ç»„æ‰å¹³åŒ–ï¼ŒdepthæŒ‡å®šå±•å¼€æ·±åº¦ï¼Œé»˜è®¤ä¸º1
- `flatMap(callback)`ï¼šå…ˆmapå†flat(æ·±åº¦ä¸º1)
- `entries()`ï¼šè¿”å›æ•°ç»„çš„é”®å€¼å¯¹è¿­ä»£å™¨
- `keys()`ï¼šè¿”å›æ•°ç»„çš„é”®è¿­ä»£å™¨
- `values()`ï¼šè¿”å›æ•°ç»„çš„å€¼è¿­ä»£å™¨

**reduceå’ŒreduceRightè¯¦è§£ï¼š**

```js
// reduce: ä»å·¦åˆ°å³ç´¯åŠ 
const arr = [1, 2, 3, 4, 5]

// æ±‚å’Œ
const sum = arr.reduce((acc, cur) => acc + cur, 0) // 15

// æ±‚æœ€å¤§å€¼
const max = arr.reduce((acc, cur) => Math.max(acc, cur)) // 5

// æ•°ç»„å»é‡
const arr2 = [1, 2, 2, 3, 3, 4]
const unique = arr2.reduce((acc, cur) => {
  if (!acc.includes(cur)) {
    acc.push(cur)
  }
  return acc
}, []) // [1, 2, 3, 4]

// å¯¹è±¡æ•°ç»„è½¬å¯¹è±¡
const users = [
  { id: 1, name: 'å¼ ä¸‰' },
  { id: 2, name: 'æå››' }
]
const userMap = users.reduce((acc, cur) => {
  acc[cur.id] = cur
  return acc
}, {}) // { 1: { id: 1, name: 'å¼ ä¸‰' }, 2: { id: 2, name: 'æå››' } }

// reduceRight: ä»å³åˆ°å·¦ç´¯åŠ 
const arr3 = ['a', 'b', 'c', 'd']
const reversed = arr3.reduceRight((acc, cur) => {
  acc.push(cur)
  return acc
}, []) // ['d', 'c', 'b', 'a']
```

## å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•

**æŸ¥æ‰¾å’Œæ£€ç´¢ï¼š**

- `charAt(index)`ï¼šè¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦
- `charCodeAt(index)`ï¼šè¿”å›æŒ‡å®šä½ç½®å­—ç¬¦çš„Unicodeç¼–ç 
- `indexOf(searchValue, fromIndex)`ï¼šè¿”å›æŸä¸ªæŒ‡å®šå­—ç¬¦ä¸²å€¼åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œæ²¡æœ‰åˆ™è¿”å›-1
- `lastIndexOf(searchValue, fromIndex)`ï¼šä»åå‘å‰æœç´¢ï¼Œè¿”å›æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®
- `search(regexp)`ï¼šæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œæˆ–æ£€ç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å­å­—ç¬¦ä¸²
- `match(regexp)`ï¼šåœ¨å­—ç¬¦ä¸²å†…æ£€ç´¢æŒ‡å®šçš„å€¼ï¼Œæˆ–æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…
- `matchAll(regexp)`ï¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ç»“æœçš„è¿­ä»£å™¨

**æˆªå–å’Œæ‹¼æ¥ï¼š**

- `slice(start, end)`ï¼šæå–å­—ç¬¦ä¸²çš„æŸä¸ªéƒ¨åˆ†ï¼Œè¿”å›æ–°å­—ç¬¦ä¸²ï¼ˆæ”¯æŒè´Ÿæ•°ï¼‰
- `substring(start, end)`ï¼šæå–å­—ç¬¦ä¸²ä¸­ä¸¤ä¸ªæŒ‡å®šçš„ç´¢å¼•å·ä¹‹é—´çš„å­—ç¬¦ï¼ˆä¸æ”¯æŒè´Ÿæ•°ï¼‰
- `substr(start, length)`ï¼šä»èµ·å§‹ç´¢å¼•å·æå–å­—ç¬¦ä¸²ä¸­æŒ‡å®šæ•°ç›®çš„å­—ç¬¦ï¼ˆå·²åºŸå¼ƒï¼‰
- `concat(str1, str2, ...)`ï¼šè¿æ¥ä¸¤ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²
- `split(separator, limit)`ï¼šæŠŠå­—ç¬¦ä¸²åˆ†å‰²ä¸ºå­—ç¬¦ä¸²æ•°ç»„

**å¤§å°å†™è½¬æ¢ï¼š**

- `toLowerCase()`ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™
- `toUpperCase()`ï¼šæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™
- `toLocaleLowerCase()`ï¼šæ ¹æ®æœ¬åœ°ä¸»æœºçš„è¯­è¨€ç¯å¢ƒæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™
- `toLocaleUpperCase()`ï¼šæ ¹æ®æœ¬åœ°ä¸»æœºçš„è¯­è¨€ç¯å¢ƒæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™

**ä¿®æ”¹å’Œæ›¿æ¢ï¼š**

- `replace(searchValue, replaceValue)`ï¼šæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„æŸäº›å­—ç¬¦ï¼ˆåªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…ï¼‰
- `replaceAll(searchValue, replaceValue)`ï¼šæ›¿æ¢æ‰€æœ‰åŒ¹é…çš„å­—ç¬¦ä¸²
- `trim()`ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦
- `trimStart()` / `trimLeft()`ï¼šå»é™¤å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºç™½å­—ç¬¦
- `trimEnd()` / `trimRight()`ï¼šå»é™¤å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºç™½å­—ç¬¦
- `padStart(targetLength, padString)`ï¼šåœ¨å­—ç¬¦ä¸²å¼€å¤´å¡«å……æŒ‡å®šå­—ç¬¦ï¼Œç›´åˆ°è¾¾åˆ°æŒ‡å®šé•¿åº¦
- `padEnd(targetLength, padString)`ï¼šåœ¨å­—ç¬¦ä¸²æœ«å°¾å¡«å……æŒ‡å®šå­—ç¬¦ï¼Œç›´åˆ°è¾¾åˆ°æŒ‡å®šé•¿åº¦
- `repeat(count)`ï¼šè¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤næ¬¡

**åˆ¤æ–­ï¼š**

- `startsWith(searchString, position)`ï¼šåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å­å­—ç¬¦ä¸²å¼€å§‹
- `endsWith(searchString, length)`ï¼šåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŒ‡å®šçš„å­å­—ç¬¦ä¸²ç»“æŸ
- `includes(searchString, position)`ï¼šåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŒ‡å®šçš„å­å­—ç¬¦ä¸²

**å…¶ä»–ï¼š**

- `length`ï¼šè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦
- `toString()`ï¼šè¿”å›å­—ç¬¦ä¸²
- `valueOf()`ï¼šè¿”å›å­—ç¬¦ä¸²å¯¹è±¡çš„åŸå§‹å€¼

## å¯¹è±¡å¸¸ç”¨æ–¹æ³•

**åˆ›å»ºå’ŒåŸå‹ï¼š**

- `Object.create(proto, propertiesObject)`ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ç°æœ‰çš„å¯¹è±¡ä½œä¸ºæ–°å¯¹è±¡çš„åŸå‹
- `Object.getPrototypeOf(obj)`ï¼šè¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹
- `Object.setPrototypeOf(obj, prototype)`ï¼šè®¾ç½®å¯¹è±¡çš„åŸå‹

**å±æ€§æ“ä½œï¼š**

- `Object.keys(obj)`ï¼šè¿”å›å¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®ç»„æˆçš„æ•°ç»„
- `Object.values(obj)`ï¼šè¿”å›å¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„å€¼ç»„æˆçš„æ•°ç»„
- `Object.entries(obj)`ï¼šè¿”å›å¯¹è±¡è‡ªèº«å¯æšä¸¾å±æ€§çš„é”®å€¼å¯¹æ•°ç»„
- `Object.fromEntries(entries)`ï¼šå°†é”®å€¼å¯¹æ•°ç»„è½¬æ¢ä¸ºå¯¹è±¡
- `Object.getOwnPropertyNames(obj)`ï¼šè¿”å›å¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§çš„é”®åï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰
- `Object.getOwnPropertySymbols(obj)`ï¼šè¿”å›å¯¹è±¡æ‰€æœ‰Symbolå±æ€§çš„æ•°ç»„

**å±æ€§æè¿°ç¬¦ï¼š**

- `Object.getOwnPropertyDescriptor(obj, prop)`ï¼šè¿”å›å¯¹è±¡æŒ‡å®šå±æ€§çš„æè¿°ç¬¦
- `Object.getOwnPropertyDescriptors(obj)`ï¼šè¿”å›å¯¹è±¡æ‰€æœ‰è‡ªèº«å±æ€§çš„æè¿°ç¬¦
- `Object.defineProperty(obj, prop, descriptor)`ï¼šå®šä¹‰å¯¹è±¡çš„æ–°å±æ€§æˆ–ä¿®æ”¹ç°æœ‰å±æ€§
- `Object.defineProperties(obj, props)`ï¼šå®šä¹‰å¯¹è±¡çš„å¤šä¸ªæ–°å±æ€§æˆ–ä¿®æ”¹å¤šä¸ªç°æœ‰å±æ€§

**å¯¹è±¡æ“ä½œï¼š**

- `Object.assign(target, ...sources)`ï¼šå°†æ‰€æœ‰å¯æšä¸¾å±æ€§ä»ä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡
- `Object.freeze(obj)`ï¼šå†»ç»“å¯¹è±¡ï¼Œä¸èƒ½æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹å±æ€§
- `Object.seal(obj)`ï¼šå¯†å°å¯¹è±¡ï¼Œä¸èƒ½æ·»åŠ ã€åˆ é™¤å±æ€§ï¼Œä½†å¯ä»¥ä¿®æ”¹ç°æœ‰å±æ€§
- `Object.preventExtensions(obj)`ï¼šé˜»æ­¢å¯¹è±¡æ‰©å±•ï¼Œä¸èƒ½æ·»åŠ æ–°å±æ€§
- `Object.isFrozen(obj)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å†»ç»“
- `Object.isSealed(obj)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å¯†å°
- `Object.isExtensible(obj)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯æ‰©å±•

**åˆ¤æ–­ï¼š**

- `Object.is(value1, value2)`ï¼šåˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒï¼ˆæ¯”===æ›´ä¸¥æ ¼ï¼‰
- `Object.hasOwn(obj, prop)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰æŒ‡å®šçš„è‡ªèº«å±æ€§ï¼ˆES2022ï¼‰
- `obj.hasOwnProperty(prop)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰æŒ‡å®šçš„è‡ªèº«å±æ€§
- `obj.isPrototypeOf(obj)`ï¼šåˆ¤æ–­å¯¹è±¡æ˜¯å¦åœ¨å¦ä¸€ä¸ªå¯¹è±¡çš„åŸå‹é“¾ä¸Š

# ä¸ƒã€æµè§ˆå™¨ç¯‡

æœ¬ç¯‡ä»‹ç»æµè§ˆå™¨ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬å­˜å‚¨æœºåˆ¶ã€è·¨åŸŸè§£å†³æ–¹æ¡ˆç­‰ã€‚

## Cookieã€LocalStorageã€SessionStorage

**å¯¹æ¯”è¡¨æ ¼ï¼š**

| ç‰¹æ€§ | Cookie | LocalStorage | SessionStorage |
|------|--------|--------------|----------------|
| å­˜å‚¨å¤§å° | 4KBå·¦å³ | 5MBå·¦å³ | 5MBå·¦å³ |
| ç”Ÿå‘½å‘¨æœŸ | å¯è®¾ç½®è¿‡æœŸæ—¶é—´ | æ°¸ä¹…ï¼Œé™¤éæ‰‹åŠ¨æ¸…é™¤ | é¡µé¢ä¼šè¯æœŸé—´ |
| ä¸æœåŠ¡å™¨é€šä¿¡ | æ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šæºå¸¦ | ä¸å‚ä¸æœåŠ¡å™¨é€šä¿¡ | ä¸å‚ä¸æœåŠ¡å™¨é€šä¿¡ |
| ä½œç”¨åŸŸ | åŒæºä¸”ç¬¦åˆpathè§„åˆ™ | åŒæº | åŒæºä¸”åŒçª—å£ |
| æ˜“ç”¨æ€§ | éœ€è¦è‡ªå·±å°è£… | ä½¿ç”¨ç®€å• | ä½¿ç”¨ç®€å• |

**Cookieè¯¦è§£ï¼š**

```js
// è®¾ç½®cookie
document.cookie = 'name=å¼ ä¸‰'
document.cookie = 'age=18; expires=Thu, 18 Dec 2025 12:00:00 GMT; path=/'

// è¯»å–cookie
console.log(document.cookie) // 'name=å¼ ä¸‰; age=18'

// åˆ é™¤cookieï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºè¿‡å»ï¼‰
document.cookie = 'name=; expires=Thu, 01 Jan 1970 00:00:00 GMT'

// Cookieå±æ€§
// - expires: è¿‡æœŸæ—¶é—´
// - max-age: æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
// - path: è·¯å¾„
// - domain: åŸŸå
// - secure: åªåœ¨HTTPSä¼ è¾“
// - httpOnly: ç¦æ­¢JavaScriptè®¿é—®ï¼ˆæœåŠ¡ç«¯è®¾ç½®ï¼‰
// - sameSite: é™åˆ¶ç¬¬ä¸‰æ–¹Cookie
```

**LocalStorageè¯¦è§£ï¼š**

```js
// å­˜å‚¨æ•°æ®
localStorage.setItem('name', 'å¼ ä¸‰')
localStorage.setItem('age', 18)

// è¯»å–æ•°æ®
localStorage.getItem('name') // 'å¼ ä¸‰'

// åˆ é™¤æ•°æ®
localStorage.removeItem('name')

// æ¸…ç©ºæ‰€æœ‰æ•°æ®
localStorage.clear()

// è·å–é”®å
localStorage.key(0) // è·å–ç¬¬ä¸€ä¸ªé”®å

// è·å–æ•°é‡
localStorage.length

// å­˜å‚¨å¯¹è±¡ï¼ˆéœ€è¦è½¬æ¢ï¼‰
const user = { name: 'å¼ ä¸‰', age: 18 }
localStorage.setItem('user', JSON.stringify(user))
const savedUser = JSON.parse(localStorage.getItem('user'))
```

**SessionStorageè¯¦è§£ï¼š**

```js
// APIä¸localStorageå®Œå…¨ç›¸åŒ
sessionStorage.setItem('name', 'å¼ ä¸‰')
sessionStorage.getItem('name')
sessionStorage.removeItem('name')
sessionStorage.clear()

// åŒºåˆ«ï¼šå…³é—­æ ‡ç­¾é¡µæˆ–æµè§ˆå™¨åæ•°æ®ä¼šè¢«æ¸…é™¤
```

**ç›‘å¬å­˜å‚¨å˜åŒ–ï¼š**

```js
// ç›‘å¬storageäº‹ä»¶ï¼ˆåªèƒ½ç›‘å¬å…¶ä»–é¡µé¢çš„ä¿®æ”¹ï¼‰
window.addEventListener('storage', (e) => {
  console.log('é”®å:', e.key)
  console.log('æ—§å€¼:', e.oldValue)
  console.log('æ–°å€¼:', e.newValue)
  console.log('URL:', e.url)
})
```

**ä½¿ç”¨åœºæ™¯ï¼š**

- **Cookie**: ç”¨æˆ·èº«ä»½éªŒè¯ã€ä¼šè¯ç®¡ç†ã€è·Ÿè¸ªç”¨æˆ·è¡Œä¸º
- **LocalStorage**: æŒä¹…åŒ–å­˜å‚¨ã€ç”¨æˆ·åå¥½è®¾ç½®ã€è´­ç‰©è½¦ï¼ˆä¸éœ€è¦ç™»å½•ï¼‰
- **SessionStorage**: è¡¨å•æ•°æ®æš‚å­˜ã€å•é¡µé¢æ•°æ®ä¼ é€’

**å®‰å…¨å»ºè®®ï¼š**

1. ä¸è¦å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€ä¿¡ç”¨å¡å·ç­‰ï¼‰
2. å¯¹å­˜å‚¨çš„æ•°æ®è¿›è¡ŒåŠ å¯†
3. è®¾ç½®HttpOnlyé˜²æ­¢XSSæ”»å‡»
4. ä½¿ç”¨Secureå±æ€§ç¡®ä¿HTTPSä¼ è¾“
5. å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

---

# å…«ã€å·¥ç¨‹åŒ–ç¯‡

æœ¬ç¯‡ä»‹ç»å‰ç«¯å·¥ç¨‹åŒ–ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†ç­‰ã€‚

## æ•°ç»„è½¬æ ‘å½¢ç»“æ„

**æ–¹æ³•ä¸€ï¼šé€’å½’å‡½æ•°**

```js
function transArrToTree(list,pid) {
  const arr = []
  list.forEach(item => {
    if(item.pid === pid) {
      item.children = transArrToTree(list,item.id)
      arr.push(item)
    }
  })
  return arr
}
```

**æ–¹æ³•äºŒï¼šmapæ˜ å°„**

```js
export function transListToTreeUseMap(list) {
  const arr = []
  const map = {}
  list.forEach(item => {
    item.children = []
    map[item.id] = item
  })
  list.forEach(item => {
    if (map[item.pid]) {
      map[item.pid].children.push(item)
    } else {
      arr.push(item)
    }
  })
  return arr
}
```

**å®ç°æ€è·¯ï¼š**

1. é¦–å…ˆå®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„ `arr` å’Œä¸€ä¸ªç©ºå¯¹è±¡ `map`ã€‚
2. éå†ä¼ å…¥çš„åˆ—è¡¨ `list`ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªç©ºçš„ `children` æ•°ç»„ï¼Œå¹¶å°†èŠ‚ç‚¹å¯¹è±¡ä»¥ `id` ä¸ºé”®ï¼Œä»¥èŠ‚ç‚¹å¯¹è±¡æœ¬èº«ä¸ºå€¼ï¼Œå­˜å…¥ `map` å¯¹è±¡ä¸­ã€‚
3. å†æ¬¡éå†ä¼ å…¥çš„åˆ—è¡¨ `list`ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå…¶çˆ¶èŠ‚ç‚¹åœ¨ `map` å¯¹è±¡ä¸­å­˜åœ¨ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹æ·»åŠ åˆ°å…¶çˆ¶èŠ‚ç‚¹çš„ `children` æ•°ç»„ä¸­ï¼›å¦åˆ™ï¼Œå°†è¯¥èŠ‚ç‚¹æ·»åŠ åˆ° `arr` æ•°ç»„ä¸­ã€‚
4. æœ€åè¿”å› `arr` æ•°ç»„ï¼Œå³ä¸ºè½¬æ¢åçš„æ ‘å½¢ç»“æ„æ•°æ®ã€‚

è¿™æ®µä»£ç çš„ä¸»è¦æ€è·¯æ˜¯åˆ©ç”¨ä¸€ä¸ªå¯¹è±¡ `map` æ¥å­˜å‚¨æ¯ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨åç»­éå†ä¸­å¿«é€ŸæŸ¥æ‰¾å…¶çˆ¶èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„ `children` æ•°ç»„ä¸­ã€‚

## æ ‘å½¢æ‰å¹³åŒ–è½¬æ•°ç»„

**é€’å½’å‡½æ•°å®ç°ï¼š**

```js
function dataFattening (data) {
  const arr = []
  data.forEach(item => {
    if(item.children?.length) {
      arr = [ ...arr, ...dataFattening(item.children) ]
    } else {
      arr.push(item)
    }
  })
  return arr
}
```

**å®ç°æ€è·¯ï¼š**

1. å®šä¹‰ä¸€ä¸ªç©ºæ•°ç»„ `arr`ã€‚
2. éå†ä¼ å…¥çš„æ ‘å½¢ç»“æ„æ•°æ® `data`ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æœ‰å­èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ï¼Œåˆ™é€’å½’è°ƒç”¨ `dataFattening` å‡½æ•°ï¼Œå°†å­èŠ‚ç‚¹æ‰å¹³åŒ–ååˆå¹¶åˆ° `arr` æ•°ç»„ä¸­ï¼›å¦åˆ™ï¼Œå°†è¯¥èŠ‚ç‚¹ç›´æ¥æ·»åŠ åˆ° `arr` æ•°ç»„ä¸­ã€‚
3. æœ€åè¿”å› `arr` æ•°ç»„ï¼Œå³ä¸ºæ‰å¹³åŒ–åçš„æ•°æ®ã€‚

è¿™æ®µä»£ç çš„ä¸»è¦æ€è·¯æ˜¯åˆ©ç”¨é€’å½’å‡½æ•°å°†åµŒå¥—çš„æ ‘å½¢ç»“æ„æ•°æ®è½¬æ¢æˆæ‰å¹³åŒ–çš„æ•°ç»„ã€‚åœ¨é€’å½’è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœå®ƒæœ‰å­èŠ‚ç‚¹ï¼Œåˆ™é€’å½’è°ƒç”¨å‡½æ•°å¤„ç†å­èŠ‚ç‚¹ï¼Œå¹¶å°†å­èŠ‚ç‚¹æ‰å¹³åŒ–åçš„ç»“æœåˆå¹¶åˆ°å½“å‰èŠ‚ç‚¹çš„æ‰å¹³åŒ–ç»“æœä¸­ã€‚å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°æ‰å¹³åŒ–ç»“æœä¸­ã€‚

**æ³¨æ„ï¼š** åœ¨è¿™æ®µä»£ç ä¸­ä½¿ç”¨äº†å¯é€‰é“¾æ“ä½œç¬¦ `?.`ï¼Œå®ƒç”¨äºåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªå±æ€§æˆ–æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è¿”å›è¯¥å±æ€§æˆ–æ–¹æ³•çš„å€¼ï¼Œå¦åˆ™è¿”å› `undefined`ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æˆ–æ–¹æ³•æ—¶å‡ºç°æŠ¥é”™ï¼Œæé«˜ä»£ç çš„å¥å£®æ€§ã€‚

## æ·±æ‹·è´

**æµ…æ‹·è´ vs æ·±æ‹·è´ï¼š**

**æµ…æ‹·è´**ï¼šåªå¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ï¼Œå¦‚æœå±æ€§å€¼æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™å¤åˆ¶çš„æ˜¯å¼•ç”¨åœ°å€ã€‚

```js
// æµ…æ‹·è´çš„å‡ ç§æ–¹å¼
const arr1 = [1, 2, 3]
const arr2 = arr1.slice()
const arr3 = arr1.concat()
const arr4 = [...arr1]
```

**æ·±æ‹·è´**ï¼šé€’å½’å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å±‚çº§ï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„æ–°å¯¹è±¡ã€‚

**æ·±æ‹·è´çš„å®ç°æ–¹å¼ï¼š**

```js
// 1. JSONæ–¹æ³•ï¼ˆç®€å•ä½†æœ‰é™åˆ¶ï¼‰
const obj1 = { a: 1, b: { c: 2 } }
const obj2 = JSON.parse(JSON.stringify(obj1))

// é™åˆ¶ï¼š
// - æ— æ³•å¤åˆ¶å‡½æ•°ã€undefinedã€Symbol
// - æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨
// - ä¼šä¸¢å¤±Dateå¯¹è±¡ã€RegExpå¯¹è±¡

// 2. é€’å½’å®ç°æ·±æ‹·è´
function deepClone(obj, hash = new WeakMap()) {
  if (obj === null) return obj
  if (obj instanceof Date) return new Date(obj)
  if (obj instanceof RegExp) return new RegExp(obj)
  if (typeof obj !== 'object') return obj

  // å¤„ç†å¾ªç¯å¼•ç”¨
  if (hash.has(obj)) return hash.get(obj)

  const cloneObj = new obj.constructor()
  hash.set(obj, cloneObj)

  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      cloneObj[key] = deepClone(obj[key], hash)
    }
  }
  return cloneObj
}

// 3. ä½¿ç”¨lodashåº“
// const obj2 = _.cloneDeep(obj1)
```

## é˜²æŠ–èŠ‚æµ

**é˜²æŠ–ï¼ˆDebounceï¼‰**ï¼šåœ¨äº‹ä»¶è¢«è§¦å‘nç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœåœ¨è¿™nç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚

**åº”ç”¨åœºæ™¯ï¼š**
- æœç´¢æ¡†è¾“å…¥è”æƒ³
- çª—å£resizeäº‹ä»¶
- è¡¨å•éªŒè¯

```js
function debounce(fn, delay) {
  let timer = null
  return function(...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(this, args)
    }, delay)
  }
}

// ä½¿ç”¨
const handleInput = debounce(function(e) {
  console.log('æœç´¢:', e.target.value)
}, 500)
```

**èŠ‚æµï¼ˆThrottleï¼‰**ï¼šè§„å®šåœ¨ä¸€ä¸ªå•ä½æ—¶é—´å†…ï¼Œåªèƒ½è§¦å‘ä¸€æ¬¡å‡½æ•°ã€‚å¦‚æœè¿™ä¸ªå•ä½æ—¶é—´å†…è§¦å‘å¤šæ¬¡å‡½æ•°ï¼Œåªæœ‰ä¸€æ¬¡ç”Ÿæ•ˆã€‚

**åº”ç”¨åœºæ™¯ï¼š**
- æ»šåŠ¨åŠ è½½
- æŒ‰é’®ç‚¹å‡»
- é¼ æ ‡ç§»åŠ¨

```js
function throttle(fn, delay) {
  let lastTime = 0
  return function(...args) {
    const now = Date.now()
    if (now - lastTime >= delay) {
      fn.apply(this, args)
      lastTime = now
    }
  }
}

// ä½¿ç”¨
const handleScroll = throttle(function() {
  console.log('æ»šåŠ¨äº‹ä»¶è§¦å‘')
}, 1000)
```

**åŒºåˆ«ï¼š**
- é˜²æŠ–ï¼šå¤šæ¬¡è§¦å‘ï¼Œåªæ‰§è¡Œæœ€åä¸€æ¬¡
- èŠ‚æµï¼šå¤šæ¬¡è§¦å‘ï¼ŒæŒ‰å›ºå®šé¢‘ç‡æ‰§è¡Œ

## å†…å­˜æ³„æ¼

å†…å­˜æ³„æ¼æ˜¯æŒ‡ç¨‹åºä¸­å·²åˆ†é…çš„å†…å­˜ç”±äºæŸç§åŸå› æœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œé€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹ã€‚

**å¸¸è§çš„å†…å­˜æ³„æ¼åœºæ™¯ï¼š**

1. **æ„å¤–çš„å…¨å±€å˜é‡**
```js
function foo() {
  bar = 'æ„å¤–çš„å…¨å±€å˜é‡' // æ²¡æœ‰ç”¨var/let/constå£°æ˜
}
```

2. **è¢«é—å¿˜çš„å®šæ—¶å™¨**
```js
const timer = setInterval(() => {
  // ä¸€äº›æ“ä½œ
}, 1000)
// å¿˜è®°clearInterval(timer)
```

3. **é—­åŒ…å¼•ç”¨**
```js
function outer() {
  const largeData = new Array(1000000)
  return function inner() {
    console.log(largeData.length)
  }
}
const fn = outer() // largeDataä¸€ç›´è¢«å¼•ç”¨ï¼Œæ— æ³•é‡Šæ”¾
```

4. **DOMå¼•ç”¨**
```js
const elements = []
function addElement() {
  const div = document.createElement('div')
  elements.push(div) // å³ä½¿divä»DOMä¸­ç§»é™¤ï¼Œä»è¢«å¼•ç”¨
}
```

5. **äº‹ä»¶ç›‘å¬å™¨æœªç§»é™¤**
```js
const element = document.getElementById('button')
element.addEventListener('click', onClick)
// å¿˜è®°removeEventListener
```

**å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼š**
- åŠæ—¶æ¸…é™¤å®šæ—¶å™¨
- ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
- é¿å…ä¸å¿…è¦çš„å…¨å±€å˜é‡
- åˆç†ä½¿ç”¨é—­åŒ…
- åŠæ—¶æ¸…é™¤DOMå¼•ç”¨

## äº‹ä»¶å§”æ‰˜&äº‹ä»¶å†’æ³¡

**äº‹ä»¶å†’æ³¡ï¼ˆEvent Bubblingï¼‰**

äº‹ä»¶å†’æ³¡æ˜¯æŒ‡å½“ä¸€ä¸ªå…ƒç´ ä¸Šè§¦å‘æŸä¸ªäº‹ä»¶æ—¶ï¼Œè¯¥äº‹ä»¶ä¼šä»è¯¥å…ƒç´ å¼€å§‹å‘ä¸Šå†’æ³¡åˆ°ç¥–å…ˆå…ƒç´ ï¼Œç›´åˆ°åˆ°è¾¾æ–‡æ¡£æ ¹èŠ‚ç‚¹ã€‚åœ¨äº‹ä»¶å†’æ³¡è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶å¯¹è±¡çš„targetå±æ€§æ¥è·å–å½“å‰è§¦å‘äº‹ä»¶çš„å…ƒç´ ã€‚

äº‹ä»¶å†’æ³¡æœºåˆ¶çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åœ¨çˆ¶å…ƒç´ ä¸Šç»Ÿä¸€å¤„ç†å¤šä¸ªå­å…ƒç´ çš„äº‹ä»¶ï¼Œä»è€Œå‡å°‘ä»£ç é‡å’Œæé«˜æ€§èƒ½ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°é€šè¿‡äº‹ä»¶å§”æ‰˜æ¥å®ç°åŠ¨æ€ç»‘å®šå’Œè§£ç»‘äº‹ä»¶å¤„ç†ç¨‹åºçš„éœ€æ±‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸åŠ ä»¥æ§åˆ¶ï¼Œäº‹ä»¶å†’æ³¡ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„äº‹ä»¶è§¦å‘å’Œå¤„ç†ï¼Œä»è€Œå½±å“åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­éœ€è¦è°¨æ…ä½¿ç”¨äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶å§”æ‰˜æŠ€æœ¯ï¼Œåˆç†æ§åˆ¶äº‹ä»¶çš„ä¼ æ’­å’Œå¤„ç†ã€‚

**äº‹ä»¶å§”æ‰˜ï¼ˆEvent Delegationï¼‰**

äº‹ä»¶å§”æ‰˜æ˜¯ä¸€ç§å¸¸è§çš„ä¼˜åŒ–æŠ€å·§ï¼Œå®ƒåˆ©ç”¨äº†äº‹ä»¶çš„å†’æ³¡æœºåˆ¶æ¥å‡å°‘äº‹ä»¶å¤„ç†ç¨‹åºçš„æ•°é‡ã€‚äº‹ä»¶å§”æ‰˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†äº‹ä»¶å¤„ç†ç¨‹åºç»‘å®šåˆ°çˆ¶å…ƒç´ ä¸Šï¼Œè€Œä¸æ˜¯ç»‘å®šåˆ°æ¯ä¸ªå­å…ƒç´ ä¸Šã€‚å½“å­å…ƒç´ ä¸Šè§¦å‘äº‹ä»¶æ—¶ï¼Œäº‹ä»¶ä¼šå†’æ³¡åˆ°çˆ¶å…ƒç´ ï¼Œç”±çˆ¶å…ƒç´ ä¸Šçš„äº‹ä»¶å¤„ç†ç¨‹åºæ¥å¤„ç†ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªåˆ—è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»‘å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºåˆ°åˆ—è¡¨çš„çˆ¶å…ƒç´ ä¸Šï¼Œç„¶åé€šè¿‡äº‹ä»¶å§”æ‰˜æ¥å¤„ç†æ¯ä¸ªå­å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨æ¯ä¸ªå­å…ƒç´ ä¸Šéƒ½ç»‘å®šä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»è€Œæé«˜æ€§èƒ½å’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚

**ç¤ºä¾‹ä»£ç ï¼š**

```js
// ä¸ä½¿ç”¨äº‹ä»¶å§”æ‰˜
const items = document.querySelectorAll('.item')
items.forEach(item => {
  item.addEventListener('click', function() {
    console.log('ç‚¹å‡»äº†', this.textContent)
  })
})

// ä½¿ç”¨äº‹ä»¶å§”æ‰˜
const list = document.querySelector('.list')
list.addEventListener('click', function(e) {
  if (e.target.classList.contains('item')) {
    console.log('ç‚¹å‡»äº†', e.target.textContent)
  }
})
```

## å‰ç«¯å¦‚ä½•æ•è·é”™è¯¯

**1. try-catch**

```js
try {
  // å¯èƒ½å‡ºé”™çš„ä»£ç 
  JSON.parse('invalid json')
} catch (error) {
  console.error('æ•è·åˆ°é”™è¯¯:', error)
}
```

**2. window.onerror**

```js
window.onerror = function(message, source, lineno, colno, error) {
  console.log('å…¨å±€é”™è¯¯:', message)
  return true // è¿”å›trueé˜»æ­¢é»˜è®¤å¤„ç†
}
```

**3. window.addEventListener('error')**

```js
window.addEventListener('error', (event) => {
  console.log('æ•è·åˆ°é”™è¯¯:', event.error)
}, true)
```

**4. Promiseé”™è¯¯æ•è·**

```js
// Promise.catch
promise.catch(error => {
  console.error('Promiseé”™è¯¯:', error)
})

// unhandledrejectionäº‹ä»¶
window.addEventListener('unhandledrejection', event => {
  console.error('æœªå¤„ç†çš„Promiseé”™è¯¯:', event.reason)
})
```

---

# ä¹ã€æ‰‹å†™å®ç°ç¯‡

æœ¬ç¯‡åŒ…å«å¸¸è§çš„æ‰‹å†™å®ç°é¢˜ç›®ã€‚

## æ‰‹å†™call

```js
Function.prototype.myCall = function(context, ...args) {
  // åˆ¤æ–­contextæ˜¯å¦ä¼ å…¥ï¼Œå¦‚æœæœªä¼ å…¥åˆ™è®¾ç½®ä¸ºwindow
  context = context || window
  // å°†è°ƒç”¨å‡½æ•°è®¾ä¸ºå¯¹è±¡çš„æ–¹æ³•
  const fn = Symbol('fn')
  context[fn] = this
  // æ‰§è¡Œè¯¥å‡½æ•°
  const result = context[fn](...args)
  // åˆ é™¤è¯¥å‡½æ•°
  delete context[fn]
  // è¿”å›ç»“æœ
  return result
}
```

### æ‰‹å†™apply

```js
Function.prototype.myApply = function(context, args) {
  context = context || window
  const fn = Symbol('fn')
  context[fn] = this
  const result = context[fn](...args)
  delete context[fn]
  return result
}
```

### æ‰‹å†™bind

```js
Function.prototype.myBind = function(context, ...args1) {
  const fn = this
  return function(...args2) {
    return fn.apply(context, [...args1, ...args2])
  }
}
```

### æ‰‹å†™new

```js
function myNew(constructor, ...args) {
  // 1. åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡
  const obj = {}
  // 2. å°†å¯¹è±¡çš„__proto__æŒ‡å‘æ„é€ å‡½æ•°çš„prototype
  obj.__proto__ = constructor.prototype
  // 3. å°†æ„é€ å‡½æ•°çš„thisæŒ‡å‘objï¼Œå¹¶æ‰§è¡Œæ„é€ å‡½æ•°
  const result = constructor.apply(obj, args)
  // 4. å¦‚æœæ„é€ å‡½æ•°è¿”å›çš„æ˜¯å¯¹è±¡ï¼Œåˆ™è¿”å›è¯¥å¯¹è±¡ï¼Œå¦åˆ™è¿”å›obj
  return result instanceof Object ? result : obj
}
```

### æ‰‹å†™instanceof

```js
function myInstanceof(left, right) {
  // è·å–å¯¹è±¡çš„åŸå‹
  let proto = Object.getPrototypeOf(left)
  // è·å–æ„é€ å‡½æ•°çš„prototype
  const prototype = right.prototype

  // åˆ¤æ–­æ„é€ å‡½æ•°çš„prototypeæ˜¯å¦åœ¨å¯¹è±¡çš„åŸå‹é“¾ä¸Š
  while (true) {
    if (!proto) return false
    if (proto === prototype) return true
    // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ç»§ç»­ä»å…¶åŸå‹ä¸Šæ‰¾
    proto = Object.getPrototypeOf(proto)
  }
}
```

### æ‰‹å†™Promise

```js
class MyPromise {
  constructor(executor) {
    this.state = 'pending'
    this.value = undefined
    this.reason = undefined
    this.onFulfilledCallbacks = []
    this.onRejectedCallbacks = []

    const resolve = (value) => {
      if (this.state === 'pending') {
        this.state = 'fulfilled'
        this.value = value
        this.onFulfilledCallbacks.forEach(fn => fn())
      }
    }

    const reject = (reason) => {
      if (this.state === 'pending') {
        this.state = 'rejected'
        this.reason = reason
        this.onRejectedCallbacks.forEach(fn => fn())
      }
    }

    try {
      executor(resolve, reject)
    } catch (error) {
      reject(error)
    }
  }

  then(onFulfilled, onRejected) {
    onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : value => value
    onRejected = typeof onRejected === 'function' ? onRejected : reason => { throw reason }

    const promise2 = new MyPromise((resolve, reject) => {
      if (this.state === 'fulfilled') {
        setTimeout(() => {
          try {
            const x = onFulfilled(this.value)
            resolve(x)
          } catch (error) {
            reject(error)
          }
        })
      }

      if (this.state === 'rejected') {
        setTimeout(() => {
          try {
            const x = onRejected(this.reason)
            resolve(x)
          } catch (error) {
            reject(error)
          }
        })
      }

      if (this.state === 'pending') {
        this.onFulfilledCallbacks.push(() => {
          setTimeout(() => {
            try {
              const x = onFulfilled(this.value)
              resolve(x)
            } catch (error) {
              reject(error)
            }
          })
        })

        this.onRejectedCallbacks.push(() => {
          setTimeout(() => {
            try {
              const x = onRejected(this.reason)
              resolve(x)
            } catch (error) {
              reject(error)
            }
          })
        })
      }
    })

    return promise2
  }

  catch(onRejected) {
    return this.then(null, onRejected)
  }

  finally(callback) {
    return this.then(
      value => MyPromise.resolve(callback()).then(() => value),
      reason => MyPromise.resolve(callback()).then(() => { throw reason })
    )
  }

  static resolve(value) {
    return new MyPromise((resolve) => resolve(value))
  }

  static reject(reason) {
    return new MyPromise((resolve, reject) => reject(reason))
  }

  static all(promises) {
    return new MyPromise((resolve, reject) => {
      const result = []
      let count = 0
      promises.forEach((promise, index) => {
        MyPromise.resolve(promise).then(value => {
          result[index] = value
          count++
          if (count === promises.length) {
            resolve(result)
          }
        }, reject)
      })
    })
  }

  static race(promises) {
    return new MyPromise((resolve, reject) => {
      promises.forEach(promise => {
        MyPromise.resolve(promise).then(resolve, reject)
      })
    })
  }
}
```

### æ‰‹å†™æ·±æ‹·è´

```js
function deepClone(obj, map = new WeakMap()) {
  // å¤„ç†nullå’Œundefined
  if (obj === null || obj === undefined) return obj

  // å¤„ç†åŸºæœ¬æ•°æ®ç±»å‹
  if (typeof obj !== 'object') return obj

  // å¤„ç†æ—¥æœŸå¯¹è±¡
  if (obj instanceof Date) return new Date(obj)

  // å¤„ç†æ­£åˆ™å¯¹è±¡
  if (obj instanceof RegExp) return new RegExp(obj)

  // å¤„ç†å¾ªç¯å¼•ç”¨
  if (map.has(obj)) return map.get(obj)

  // æ ¹æ®åŸå‹åˆ›å»ºæ–°å¯¹è±¡
  const cloneObj = new obj.constructor()
  map.set(obj, cloneObj)

  // é€’å½’æ‹·è´
  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      cloneObj[key] = deepClone(obj[key], map)
    }
  }

  return cloneObj
}
```

### æ‰‹å†™é˜²æŠ–

```js
function debounce(fn, delay) {
  let timer = null
  return function(...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      fn.apply(this, args)
    }, delay)
  }
}
```

### æ‰‹å†™èŠ‚æµ

```js
// æ—¶é—´æˆ³ç‰ˆæœ¬
function throttle(fn, delay) {
  let lastTime = 0
  return function(...args) {
    const now = Date.now()
    if (now - lastTime >= delay) {
      fn.apply(this, args)
      lastTime = now
    }
  }
}

// å®šæ—¶å™¨ç‰ˆæœ¬
function throttle(fn, delay) {
  let timer = null
  return function(...args) {
    if (!timer) {
      timer = setTimeout(() => {
        fn.apply(this, args)
        timer = null
      }, delay)
    }
  }
}
```

### æ‰‹å†™æŸ¯é‡ŒåŒ–

```js
function curry(fn) {
  return function curried(...args) {
    // å¦‚æœå‚æ•°å¤Ÿäº†ï¼Œå°±æ‰§è¡Œå‡½æ•°
    if (args.length >= fn.length) {
      return fn.apply(this, args)
    } else {
      // å¦åˆ™è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç»§ç»­æ¥æ”¶å‚æ•°
      return function(...args2) {
        return curried.apply(this, args.concat(args2))
      }
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function add(a, b, c) {
  return a + b + c
}
const curriedAdd = curry(add)
console.log(curriedAdd(1)(2)(3)) // 6
console.log(curriedAdd(1, 2)(3)) // 6
console.log(curriedAdd(1, 2, 3)) // 6
```

---

# åã€å…¶ä»–ç¯‡

æœ¬ç¯‡åŒ…å«Proxyã€Reflectã€ä¸¥æ ¼æ¨¡å¼ç­‰å…¶ä»–é‡è¦çŸ¥è¯†ç‚¹ã€‚

## Proxyå’ŒReflect

**Proxy**

Proxyç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œå¯ä»¥æ‹¦æˆªå¹¶è‡ªå®šä¹‰å¯¹è±¡çš„åŸºæœ¬æ“ä½œï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ç­‰ï¼‰ã€‚Vue 3çš„å“åº”å¼ç³»ç»Ÿå°±æ˜¯åŸºäºProxyå®ç°çš„ã€‚

```js
const obj = { name: 'å¼ ä¸‰', age: 18 }

const proxy = new Proxy(obj, {
  // æ‹¦æˆªè¯»å–æ“ä½œ
  get(target, key) {
    console.log(`è¯»å–äº†${key}å±æ€§`)
    return target[key]
  },
  // æ‹¦æˆªèµ‹å€¼æ“ä½œ
  set(target, key, value) {
    console.log(`è®¾ç½®äº†${key}å±æ€§ä¸º${value}`)
    target[key] = value
    return true
  },
  // æ‹¦æˆªåˆ é™¤æ“ä½œ
  deleteProperty(target, key) {
    console.log(`åˆ é™¤äº†${key}å±æ€§`)
    delete target[key]
    return true
  },
  // æ‹¦æˆªinæ“ä½œç¬¦
  has(target, key) {
    console.log(`åˆ¤æ–­æ˜¯å¦æœ‰${key}å±æ€§`)
    return key in target
  }
})

proxy.name // è¾“å‡ºï¼šè¯»å–äº†nameå±æ€§
proxy.age = 20 // è¾“å‡ºï¼šè®¾ç½®äº†ageå±æ€§ä¸º20
delete proxy.age // è¾“å‡ºï¼šåˆ é™¤äº†ageå±æ€§
'name' in proxy // è¾“å‡ºï¼šåˆ¤æ–­æ˜¯å¦æœ‰nameå±æ€§
```

**Reflect**

Reflectæ˜¯ä¸€ä¸ªå†…ç½®å¯¹è±¡ï¼Œæä¾›äº†æ‹¦æˆªJavaScriptæ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸Proxyçš„handleræ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚

```js
const obj = { name: 'å¼ ä¸‰', age: 18 }

// è¯»å–å±æ€§
Reflect.get(obj, 'name') // "å¼ ä¸‰"

// è®¾ç½®å±æ€§
Reflect.set(obj, 'age', 20) // true

// åˆ é™¤å±æ€§
Reflect.deleteProperty(obj, 'age') // true

// åˆ¤æ–­å±æ€§æ˜¯å¦å­˜åœ¨
Reflect.has(obj, 'name') // true

// è·å–å¯¹è±¡çš„æ‰€æœ‰å±æ€§å
Reflect.ownKeys(obj) // ['name']
```

**Proxy vs Object.defineProperty**

è¿™æ˜¯Vue 2å’ŒVue 3å“åº”å¼åŸç†çš„åŒºåˆ«ï¼š

| ç‰¹æ€§ | Object.defineProperty | Proxy |
|------|----------------------|-------|
| ç›‘å¬å±æ€§ | éœ€è¦éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§ | ç›´æ¥ç›‘å¬æ•´ä¸ªå¯¹è±¡ |
| ç›‘å¬æ•°ç»„ | æ— æ³•ç›‘å¬æ•°ç»„çš„å˜åŒ– | å¯ä»¥ç›‘å¬æ•°ç»„çš„å˜åŒ– |
| æ·»åŠ /åˆ é™¤å±æ€§ | æ— æ³•ç›‘å¬ | å¯ä»¥ç›‘å¬ |
| æ€§èƒ½ | åˆå§‹åŒ–æ—¶éœ€è¦éå†æ‰€æœ‰å±æ€§ | æƒ°æ€§ç›‘å¬ï¼Œæ€§èƒ½æ›´å¥½ |
| å…¼å®¹æ€§ | å…¼å®¹IE9+ | ä¸å…¼å®¹IE |

## ä¸¥æ ¼æ¨¡å¼

**ä»€ä¹ˆæ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Ÿ**

ä¸¥æ ¼æ¨¡å¼æ˜¯ES5å¼•å…¥çš„ä¸€ç§è¿è¡Œæ¨¡å¼ï¼Œé€šè¿‡åœ¨è„šæœ¬æˆ–å‡½æ•°å¼€å¤´æ·»åŠ `'use strict'`æ¥å¯ç”¨ã€‚ä¸¥æ ¼æ¨¡å¼æ¶ˆé™¤äº†JavaScriptè¯­æ³•çš„ä¸€äº›ä¸åˆç†ã€ä¸ä¸¥è°¨ä¹‹å¤„ï¼Œå‡å°‘äº†ä¸€äº›æ€ªå¼‚è¡Œä¸ºã€‚

**å¦‚ä½•å¯ç”¨ï¼Ÿ**

```js
// å…¨å±€ä¸¥æ ¼æ¨¡å¼
'use strict'

// å‡½æ•°çº§ä¸¥æ ¼æ¨¡å¼
function fn() {
  'use strict'
  // ...
}
```

**ä¸¥æ ¼æ¨¡å¼çš„é™åˆ¶ï¼š**

1. å˜é‡å¿…é¡»å£°æ˜åä½¿ç”¨
```js
'use strict'
x = 10 // æŠ¥é”™ï¼šx is not defined
```

2. ç¦æ­¢ä½¿ç”¨withè¯­å¥
```js
'use strict'
with (obj) { } // æŠ¥é”™
```

3. ç¦æ­¢thisæŒ‡å‘å…¨å±€å¯¹è±¡
```js
'use strict'
function fn() {
  console.log(this) // undefined
}
fn()
```

4. ç¦æ­¢åˆ é™¤å˜é‡
```js
'use strict'
var x = 1
delete x // æŠ¥é”™
```

5. å¯¹è±¡ä¸èƒ½æœ‰é‡å¤çš„å±æ€§å
```js
'use strict'
const obj = { a: 1, a: 2 } // æŠ¥é”™
```

6. å‡½æ•°ä¸èƒ½æœ‰é‡å¤çš„å‚æ•°å
```js
'use strict'
function fn(a, a) { } // æŠ¥é”™
```

7. ç¦æ­¢å…«è¿›åˆ¶è¡¨ç¤ºæ³•
```js
'use strict'
const num = 0123 // æŠ¥é”™
```

8. argumentså¯¹è±¡ä¸å†è¿½è¸ªå‚æ•°å˜åŒ–
```js
'use strict'
function fn(a) {
  a = 2
  console.log(arguments[0]) // 1ï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯2ï¼‰
}
fn(1)
```

## æ€§èƒ½ä¼˜åŒ–

**ä»£ç å±‚é¢ä¼˜åŒ–ï¼š**

1. **é˜²æŠ–èŠ‚æµ**ï¼šå‡å°‘é«˜é¢‘äº‹ä»¶è§¦å‘çš„æ¬¡æ•°
2. **å›¾ç‰‡æ‡’åŠ è½½**ï¼šä½¿ç”¨Intersection Observer API
3. **è™šæ‹Ÿæ»šåŠ¨**ï¼šåªæ¸²æŸ“å¯è§†åŒºåŸŸçš„å†…å®¹
4. **Web Worker**ï¼šå°†è€—æ—¶è®¡ç®—æ”¾åˆ°workerçº¿ç¨‹
5. **requestAnimationFrame**ï¼šä¼˜åŒ–åŠ¨ç”»æ€§èƒ½
6. **äº‹ä»¶å§”æ‰˜**ï¼šå‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡
7. **å‡å°‘é‡æ’é‡ç»˜**ï¼šæ‰¹é‡ä¿®æ”¹DOMï¼Œä½¿ç”¨documentFragment
8. **ä½¿ç”¨CSSåŠ¨ç”»ä»£æ›¿JSåŠ¨ç”»**ï¼šç¡¬ä»¶åŠ é€Ÿ

**èµ„æºä¼˜åŒ–ï¼š**

1. **ä»£ç åˆ†å‰²**ï¼šæŒ‰éœ€åŠ è½½ï¼Œå‡å°‘é¦–å±åŠ è½½æ—¶é—´
2. **Tree Shaking**ï¼šç§»é™¤æœªä½¿ç”¨çš„ä»£ç 
3. **å‹ç¼©ä»£ç **ï¼šä½¿ç”¨terserç­‰å·¥å…·å‹ç¼©JS
4. **å›¾ç‰‡ä¼˜åŒ–**ï¼šä½¿ç”¨webpæ ¼å¼ï¼Œå‹ç¼©å›¾ç‰‡
5. **CDNåŠ é€Ÿ**ï¼šé™æ€èµ„æºä½¿ç”¨CDN
6. **å¼€å¯Gzipå‹ç¼©**ï¼šå‡å°ä¼ è¾“ä½“ç§¯
7. **æµè§ˆå™¨ç¼“å­˜**ï¼šåˆç†è®¾ç½®ç¼“å­˜ç­–ç•¥
8. **é¢„åŠ è½½/é¢„è¿æ¥**ï¼šä½¿ç”¨linkæ ‡ç­¾çš„relå±æ€§

**æ‰“åŒ…ä¼˜åŒ–ï¼š**

1. **ç¼©å°æ‰“åŒ…ä½“ç§¯**ï¼šä½¿ç”¨ç”Ÿäº§æ¨¡å¼æ‰“åŒ…
2. **splitChunks**ï¼šæå–å…¬å…±ä»£ç 
3. **externals**ï¼šå¤–éƒ¨ä¾èµ–ä¸æ‰“åŒ…
4. **DLL**ï¼šé¢„ç¼–è¯‘ä¾èµ–åº“
5. **happypack/thread-loader**ï¼šå¤šçº¿ç¨‹æ‰“åŒ…

## è·¨åŸŸè§£å†³æ–¹æ¡ˆ

**ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ**

è·¨åŸŸæ˜¯æŒ‡æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå®æ–½çš„åŒæºç­–ç•¥é™åˆ¶ã€‚å½“åè®®ã€åŸŸåã€ç«¯å£ä»»ä¸€ä¸åŒæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿè·¨åŸŸã€‚

**åŒæºç­–ç•¥é™åˆ¶ï¼š**
- æ— æ³•è¯»å–Cookieã€LocalStorageã€SessionStorage
- æ— æ³•æ“ä½œDOM
- AJAXè¯·æ±‚æ— æ³•å‘é€

**è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼š**

### 1. JSONPï¼ˆåªæ”¯æŒGETè¯·æ±‚ï¼‰

åŸç†ï¼šåˆ©ç”¨scriptæ ‡ç­¾ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„ç‰¹æ€§ã€‚

```js
// å‰ç«¯ä»£ç 
function jsonpCallback(data) {
  console.log('è·å–åˆ°æ•°æ®:', data)
}

const script = document.createElement('script')
script.src = 'http://example.com/api?callback=jsonpCallback'
document.body.appendChild(script)

// æœåŠ¡å™¨è¿”å›
// jsonpCallback({ name: 'å¼ ä¸‰', age: 18 })

// å°è£…JSONP
function jsonp(url, callback) {
  return new Promise((resolve, reject) => {
    const callbackName = 'jsonp_' + Date.now()
    window[callbackName] = (data) => {
      resolve(data)
      delete window[callbackName]
      document.body.removeChild(script)
    }
    const script = document.createElement('script')
    script.src = `${url}?callback=${callbackName}`
    script.onerror = reject
    document.body.appendChild(script)
  })
}

// ä½¿ç”¨
jsonp('http://example.com/api').then(data => {
  console.log(data)
})
```

### 2. CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰

æœåŠ¡å™¨è®¾ç½®å“åº”å¤´ï¼Œå…è®¸è·¨åŸŸè¯·æ±‚ã€‚

```js
// Node.js (Express) æœåŠ¡ç«¯è®¾ç½®
app.use((req, res, next) => {
  // å…è®¸çš„æº
  res.header('Access-Control-Allow-Origin', '*') // æˆ–æŒ‡å®šåŸŸå
  // å…è®¸çš„è¯·æ±‚æ–¹æ³•
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS')
  // å…è®¸çš„è¯·æ±‚å¤´
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization')
  // å…è®¸æºå¸¦Cookie
  res.header('Access-Control-Allow-Credentials', 'true')
  // é¢„æ£€è¯·æ±‚ç¼“å­˜æ—¶é—´
  res.header('Access-Control-Max-Age', '86400')

  if (req.method === 'OPTIONS') {
    res.sendStatus(200)
  } else {
    next()
  }
})

// å‰ç«¯æºå¸¦Cookie
fetch('http://example.com/api', {
  credentials: 'include' // æºå¸¦Cookie
})
```

### 3. ä»£ç†æœåŠ¡å™¨

å¼€å‘ç¯å¢ƒä½¿ç”¨webpack devServerä»£ç†ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨Nginxåå‘ä»£ç†ã€‚

```js
// webpack.config.js
module.exports = {
  devServer: {
    proxy: {
      '/api': {
        target: 'http://example.com', // ç›®æ ‡æœåŠ¡å™¨
        changeOrigin: true, // ä¿®æ”¹è¯·æ±‚å¤´ä¸­çš„host
        pathRewrite: {
          '^/api': '' // é‡å†™è·¯å¾„
        }
      }
    }
  }
}

// å‰ç«¯è¯·æ±‚
fetch('/api/users') // å®é™…è¯·æ±‚: http://example.com/users
```

```nginx
# Nginxé…ç½®
server {
  listen 80;
  server_name localhost;

  location /api {
    proxy_pass http://example.com;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}
```

### 4. postMessageï¼ˆçª—å£é€šä¿¡ï¼‰

ç”¨äºä¸åŒçª—å£ä¹‹é—´çš„è·¨åŸŸé€šä¿¡ã€‚

```js
// çˆ¶çª—å£å‘å­çª—å£å‘é€æ¶ˆæ¯
const iframe = document.getElementById('myIframe')
iframe.contentWindow.postMessage('Hello from parent', 'http://example.com')

// å­çª—å£æ¥æ”¶æ¶ˆæ¯
window.addEventListener('message', (e) => {
  // éªŒè¯æ¥æº
  if (e.origin !== 'http://parent.com') return

  console.log('æ”¶åˆ°æ¶ˆæ¯:', e.data)

  // å›å¤æ¶ˆæ¯
  e.source.postMessage('Hello from child', e.origin)
})
```

### 5. WebSocket

WebSocketä¸å—åŒæºç­–ç•¥é™åˆ¶ã€‚

```js
const socket = new WebSocket('ws://example.com')

socket.onopen = () => {
  console.log('è¿æ¥æˆåŠŸ')
  socket.send('Hello Server')
}

socket.onmessage = (e) => {
  console.log('æ”¶åˆ°æ¶ˆæ¯:', e.data)
}
```

### 6. document.domainï¼ˆä¸»åŸŸç›¸åŒçš„æƒ…å†µï¼‰

```js
// a.example.comé¡µé¢
document.domain = 'example.com'

// b.example.comé¡µé¢
document.domain = 'example.com'

// ç°åœ¨å¯ä»¥äº’ç›¸è®¿é—®äº†
```

### 7. window.name

```js
// a.html
window.name = 'data from a.html'
location.href = 'b.html'

// b.html
console.log(window.name) // 'data from a.html'
```

## Ajax å’Œ Fetch

### Ajaxï¼ˆXMLHttpRequestï¼‰

```js
// åˆ›å»ºXMLHttpRequestå¯¹è±¡
const xhr = new XMLHttpRequest()

// é…ç½®è¯·æ±‚
xhr.open('GET', '/api/users', true) // æ–¹æ³•ã€URLã€æ˜¯å¦å¼‚æ­¥

// è®¾ç½®è¯·æ±‚å¤´
xhr.setRequestHeader('Content-Type', 'application/json')

// ç›‘å¬çŠ¶æ€å˜åŒ–
xhr.onreadystatechange = function() {
  // readyState:
  // 0: æœªåˆå§‹åŒ–
  // 1: æ­£åœ¨åŠ è½½
  // 2: åŠ è½½å®Œæˆ
  // 3: äº¤äº’ä¸­
  // 4: å®Œæˆ
  if (xhr.readyState === 4) {
    if (xhr.status === 200) {
      console.log('æˆåŠŸ:', xhr.responseText)
    } else {
      console.log('å¤±è´¥:', xhr.status)
    }
  }
}

// ç›‘å¬è¿›åº¦
xhr.upload.onprogress = function(e) {
  if (e.lengthComputable) {
    const percent = (e.loaded / e.total) * 100
    console.log(`ä¸Šä¼ è¿›åº¦: ${percent}%`)
  }
}

// å‘é€è¯·æ±‚
xhr.send(JSON.stringify({ name: 'å¼ ä¸‰' }))

// å–æ¶ˆè¯·æ±‚
// xhr.abort()

// å°è£…Ajax
function ajax(options) {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest()
    const { method = 'GET', url, data, headers = {} } = options

    xhr.open(method, url, true)

    // è®¾ç½®è¯·æ±‚å¤´
    Object.keys(headers).forEach(key => {
      xhr.setRequestHeader(key, headers[key])
    })

    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status >= 200 && xhr.status < 300) {
          resolve(JSON.parse(xhr.responseText))
        } else {
          reject(new Error(xhr.statusText))
        }
      }
    }

    xhr.onerror = function() {
      reject(new Error('Network Error'))
    }

    xhr.send(data ? JSON.stringify(data) : null)
  })
}

// ä½¿ç”¨
ajax({
  method: 'POST',
  url: '/api/users',
  data: { name: 'å¼ ä¸‰', age: 18 },
  headers: { 'Content-Type': 'application/json' }
}).then(res => {
  console.log('æˆåŠŸ:', res)
}).catch(err => {
  console.log('å¤±è´¥:', err)
})
```

### Fetch API

```js
// åŸºæœ¬ç”¨æ³•
fetch('/api/users')
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok')
    }
    return response.json()
  })
  .then(data => console.log(data))
  .catch(error => console.error('Error:', error))

// POSTè¯·æ±‚
fetch('/api/users', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ name: 'å¼ ä¸‰', age: 18 })
})
  .then(response => response.json())
  .then(data => console.log(data))

// æºå¸¦Cookie
fetch('/api/users', {
  credentials: 'include' // same-origin | include | omit
})

// è®¾ç½®è¶…æ—¶
const controller = new AbortController()
const timeoutId = setTimeout(() => controller.abort(), 5000)

fetch('/api/users', {
  signal: controller.signal
})
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(err => {
    if (err.name === 'AbortError') {
      console.log('è¯·æ±‚è¶…æ—¶')
    }
  })
  .finally(() => clearTimeout(timeoutId))

// ä¸Šä¼ æ–‡ä»¶
const formData = new FormData()
formData.append('file', fileInput.files[0])
formData.append('name', 'å¼ ä¸‰')

fetch('/api/upload', {
  method: 'POST',
  body: formData
})
  .then(response => response.json())
  .then(data => console.log(data))

// async/awaitå†™æ³•
async function getUsers() {
  try {
    const response = await fetch('/api/users')
    if (!response.ok) {
      throw new Error('Network response was not ok')
    }
    const data = await response.json()
    console.log(data)
  } catch (error) {
    console.error('Error:', error)
  }
}
```

### Ajax vs Fetch

| ç‰¹æ€§ | Ajax (XMLHttpRequest) | Fetch |
|------|----------------------|-------|
| è¯­æ³• | å›è°ƒå‡½æ•° | Promise |
| æµè§ˆå™¨å…¼å®¹æ€§ | å…¼å®¹æ€§å¥½ | ä¸æ”¯æŒIE |
| è¶…æ—¶æ§åˆ¶ | å†…ç½®timeout | éœ€è¦AbortController |
| ä¸Šä¼ è¿›åº¦ | æ”¯æŒ | ä¸æ”¯æŒ |
| é”™è¯¯å¤„ç† | çŠ¶æ€ç é”™è¯¯ä¼šè§¦å‘error | åªæœ‰ç½‘ç»œé”™è¯¯æ‰reject |
| Cookie | é»˜è®¤æºå¸¦ | éœ€è¦é…ç½®credentials |
| å–æ¶ˆè¯·æ±‚ | abort() | AbortController |

## Symbolè¯¦è§£

**ä»€ä¹ˆæ˜¯Symbolï¼Ÿ**

Symbolæ˜¯ES6æ–°å¢çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ï¼Œä¸»è¦ç”¨äºå¯¹è±¡å±æ€§åï¼Œé¿å…å±æ€§åå†²çªã€‚

**åŸºæœ¬ç”¨æ³•ï¼š**

```js
// åˆ›å»ºSymbol
const s1 = Symbol()
const s2 = Symbol()
console.log(s1 === s2) // false

// å¸¦æè¿°çš„Symbol
const s3 = Symbol('mySymbol')
console.log(s3.toString()) // 'Symbol(mySymbol)'
console.log(s3.description) // 'mySymbol'

// ä½œä¸ºå¯¹è±¡å±æ€§
const obj = {
  [s3]: 'value'
}
console.log(obj[s3]) // 'value'
console.log(obj.s3) // undefined (ä¸èƒ½ç”¨ç‚¹è¯­æ³•è®¿é—®)

// Symbolå±æ€§ä¸ä¼šè¢«å¸¸è§„éå†
const obj2 = {
  name: 'å¼ ä¸‰',
  [Symbol('age')]: 18,
  [Symbol('gender')]: 'ç”·'
}

Object.keys(obj2) // ['name']
Object.getOwnPropertyNames(obj2) // ['name']
for (let key in obj2) { console.log(key) } // name

// è·å–Symbolå±æ€§
Object.getOwnPropertySymbols(obj2) // [Symbol(age), Symbol(gender)]
Reflect.ownKeys(obj2) // ['name', Symbol(age), Symbol(gender)]
```

**Symbol.for() å’Œ Symbol.keyFor()ï¼š**

```js
// Symbol.for(): å…¨å±€æ³¨å†Œ
const s1 = Symbol.for('foo')
const s2 = Symbol.for('foo')
console.log(s1 === s2) // true (å…±äº«åŒä¸€ä¸ªSymbol)

// Symbol.keyFor(): è·å–Symbolçš„key
const s3 = Symbol.for('bar')
console.log(Symbol.keyFor(s3)) // 'bar'

const s4 = Symbol('baz')
console.log(Symbol.keyFor(s4)) // undefined (ä¸æ˜¯é€šè¿‡Symbol.foråˆ›å»ºçš„)
```

**å†…ç½®Symbolå€¼ï¼š**

```js
// Symbol.iterator: å¯¹è±¡çš„è¿­ä»£å™¨
const arr = [1, 2, 3]
const iterator = arr[Symbol.iterator]()
console.log(iterator.next()) // { value: 1, done: false }
console.log(iterator.next()) // { value: 2, done: false }
console.log(iterator.next()) // { value: 3, done: false }
console.log(iterator.next()) // { value: undefined, done: true }

// è‡ªå®šä¹‰è¿­ä»£å™¨
const obj = {
  data: ['a', 'b', 'c'],
  [Symbol.iterator]() {
    let index = 0
    return {
      next: () => {
        if (index < this.data.length) {
          return { value: this.data[index++], done: false }
        } else {
          return { done: true }
        }
      }
    }
  }
}

for (let item of obj) {
  console.log(item) // 'a' 'b' 'c'
}

// Symbol.toStringTag: è‡ªå®šä¹‰toString()çš„è¿”å›å€¼
class MyClass {
  get [Symbol.toStringTag]() {
    return 'MyClass'
  }
}
const instance = new MyClass()
console.log(Object.prototype.toString.call(instance)) // '[object MyClass]'

// Symbol.hasInstance: è‡ªå®šä¹‰instanceofè¡Œä¸º
class MyArray {
  static [Symbol.hasInstance](instance) {
    return Array.isArray(instance)
  }
}
console.log([] instanceof MyArray) // true
console.log({} instanceof MyArray) // false
```

**ä½¿ç”¨åœºæ™¯ï¼š**

1. å¯¹è±¡å±æ€§åï¼Œé¿å…å†²çª
2. å®šä¹‰ç±»çš„ç§æœ‰å±æ€§å’Œæ–¹æ³•
3. æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²ï¼ˆä»£ç ä¸­å¤šæ¬¡å‡ºç°çš„ç‰¹å®šå­—ç¬¦ä¸²ï¼‰

```js
// æ¶ˆé™¤é­”æœ¯å­—ç¬¦ä¸²
// ä¸å¥½çš„å†™æ³•
function getArea(shape) {
  if (shape === 'triangle') {
    return 'triangle'
  }
  if (shape === 'circle') {
    return 'circle'
  }
}

// å¥½çš„å†™æ³•
const shapeType = {
  triangle: Symbol('triangle'),
  circle: Symbol('circle')
}

function getArea(shape) {
  if (shape === shapeType.triangle) {
    return shapeType.triangle
  }
  if (shape === shapeType.circle) {
    return shapeType.circle
  }
}
```

## è¿­ä»£å™¨ï¼ˆIteratorï¼‰å’Œç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰

### è¿­ä»£å™¨ï¼ˆIteratorï¼‰

**ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ**

è¿­ä»£å™¨æ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†Iteratoræ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œã€‚

**è¿­ä»£å™¨åè®®ï¼š**

```js
// è¿­ä»£å™¨å¯¹è±¡å¿…é¡»æœ‰next()æ–¹æ³•
// next()æ–¹æ³•è¿”å›: { value: å½“å‰å€¼, done: æ˜¯å¦å®Œæˆ }

// æ‰‹åŠ¨å®ç°è¿­ä»£å™¨
function createIterator(arr) {
  let index = 0
  return {
    next() {
      if (index < arr.length) {
        return { value: arr[index++], done: false }
      } else {
        return { value: undefined, done: true }
      }
    }
  }
}

const iterator = createIterator([1, 2, 3])
console.log(iterator.next()) // { value: 1, done: false }
console.log(iterator.next()) // { value: 2, done: false }
console.log(iterator.next()) // { value: 3, done: false }
console.log(iterator.next()) // { value: undefined, done: true }
```

**å¯è¿­ä»£å¯¹è±¡ï¼š**

éƒ¨ç½²äº†`Symbol.iterator`å±æ€§çš„å¯¹è±¡å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚

```js
// åŸç”Ÿå…·å¤‡Iteratoræ¥å£çš„æ•°æ®ç»“æ„
// - Array
// - String
// - Set
// - Map
// - TypedArray
// - å‡½æ•°çš„argumentså¯¹è±¡
// - NodeListå¯¹è±¡

// è‡ªå®šä¹‰å¯è¿­ä»£å¯¹è±¡
const iterable = {
  data: ['a', 'b', 'c'],
  [Symbol.iterator]() {
    let index = 0
    const data = this.data
    return {
      next() {
        if (index < data.length) {
          return { value: data[index++], done: false }
        } else {
          return { done: true }
        }
      }
    }
  }
}

// ä½¿ç”¨for...oféå†
for (let item of iterable) {
  console.log(item) // 'a' 'b' 'c'
}

// ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦
console.log([...iterable]) // ['a', 'b', 'c']

// ä½¿ç”¨Array.from
console.log(Array.from(iterable)) // ['a', 'b', 'c']
```

### ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰

**ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ**

ç”Ÿæˆå™¨æ˜¯ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚

**åŸºæœ¬è¯­æ³•ï¼š**

```js
// ç”Ÿæˆå™¨å‡½æ•°
function* gen() {
  yield 1
  yield 2
  yield 3
  return 4
}

const g = gen()
console.log(g.next()) // { value: 1, done: false }
console.log(g.next()) // { value: 2, done: false }
console.log(g.next()) // { value: 3, done: false }
console.log(g.next()) // { value: 4, done: true }
console.log(g.next()) // { value: undefined, done: true }

// for...oféå†ï¼ˆä¸åŒ…æ‹¬returnçš„å€¼ï¼‰
for (let item of gen()) {
  console.log(item) // 1 2 3
}
```

**yieldè¡¨è¾¾å¼ï¼š**

```js
function* gen() {
  const a = yield 1
  console.log('a:', a)
  const b = yield 2
  console.log('b:', b)
  return 3
}

const g = gen()
console.log(g.next()) // { value: 1, done: false }
console.log(g.next('å‚æ•°A')) // æ‰“å°: a: å‚æ•°A, è¿”å›: { value: 2, done: false }
console.log(g.next('å‚æ•°B')) // æ‰“å°: b: å‚æ•°B, è¿”å›: { value: 3, done: true }
```

**Generatorå®ç°å¼‚æ­¥æ“ä½œï¼š**

```js
// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
function* asyncGenerator() {
  console.log('å¼€å§‹')

  const data1 = yield fetch('/api/user')
  console.log('ç”¨æˆ·æ•°æ®:', data1)

  const data2 = yield fetch(`/api/posts/${data1.id}`)
  console.log('æ–‡ç« æ•°æ®:', data2)

  return 'å®Œæˆ'
}

// è‡ªåŠ¨æ‰§è¡Œå™¨
function run(gen) {
  const g = gen()

  function next(data) {
    const result = g.next(data)
    if (result.done) return result.value
    result.value.then(response => response.json()).then(data => {
      next(data)
    })
  }

  next()
}

run(asyncGenerator)

// Generator vs async/await
// async/awaitå°±æ˜¯Generatorçš„è¯­æ³•ç³–
// ä¸Šé¢çš„ä»£ç ç”¨async/awaitæ”¹å†™ï¼š
async function asyncFunction() {
  console.log('å¼€å§‹')

  const response1 = await fetch('/api/user')
  const data1 = await response1.json()
  console.log('ç”¨æˆ·æ•°æ®:', data1)

  const response2 = await fetch(`/api/posts/${data1.id}`)
  const data2 = await response2.json()
  console.log('æ–‡ç« æ•°æ®:', data2)

  return 'å®Œæˆ'
}
```

**Generatoråº”ç”¨ï¼š**

```js
// 1. æ— é™åºåˆ—
function* fibonacci() {
  let [prev, curr] = [0, 1]
  while (true) {
    yield curr;
    [prev, curr] = [curr, prev + curr]
  }
}

const fib = fibonacci()
console.log(fib.next().value) // 1
console.log(fib.next().value) // 1
console.log(fib.next().value) // 2
console.log(fib.next().value) // 3
console.log(fib.next().value) // 5

// 2. çŠ¶æ€æœº
function* stateMachine() {
  while (true) {
    yield 'A'
    yield 'B'
    yield 'C'
  }
}

const state = stateMachine()
console.log(state.next().value) // 'A'
console.log(state.next().value) // 'B'
console.log(state.next().value) // 'C'
console.log(state.next().value) // 'A'

// 3. åç¨‹ï¼ˆæ§åˆ¶æµç¨‹ï¼‰
function* gen1() {
  yield 1
  yield* gen2() // å§”æ‰˜ç»™å¦ä¸€ä¸ªç”Ÿæˆå™¨
  yield 4
}

function* gen2() {
  yield 2
  yield 3
}

for (let item of gen1()) {
  console.log(item) // 1 2 3 4
}
```


## æ— æ„ŸçŸ¥ç™»å½•

æ— æ„ŸçŸ¥ç™»å½•æ˜¯æŒ‡åœ¨ç”¨æˆ·tokenè¿‡æœŸåï¼Œè‡ªåŠ¨åˆ·æ–°tokenå¹¶é‡æ–°å‘èµ·è¯·æ±‚ï¼Œç”¨æˆ·æ— éœ€é‡æ–°ç™»å½•ã€‚

**å®ç°æ€è·¯ï¼š**

1. **è¯·æ±‚æ‹¦æˆªå™¨**ï¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ token
2. **å“åº”æ‹¦æˆªå™¨**ï¼š
   - å¦‚æœè¿”å›401ï¼ˆtokenè¿‡æœŸï¼‰ï¼Œè°ƒç”¨åˆ·æ–°tokenæ¥å£
   - åˆ·æ–°æˆåŠŸåï¼Œé‡æ–°å‘èµ·ä¹‹å‰å¤±è´¥çš„è¯·æ±‚
   - åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ

**ç¤ºä¾‹ä»£ç ï¼š**

```js
// axiosæ‹¦æˆªå™¨å®ç°
let isRefreshing = false // æ˜¯å¦æ­£åœ¨åˆ·æ–°token
let requests = [] // å­˜å‚¨å¾…é‡å‘çš„è¯·æ±‚

axios.interceptors.response.use(
  response => response,
  async error => {
    const { config, response } = error

    // tokenè¿‡æœŸ
    if (response?.status === 401) {
      if (!isRefreshing) {
        isRefreshing = true

        try {
          // åˆ·æ–°token
          const { data } = await refreshToken()
          localStorage.setItem('token', data.token)

          // é‡å‘æ‰€æœ‰å¾…å¤„ç†çš„è¯·æ±‚
          requests.forEach(cb => cb(data.token))
          requests = []

          // é‡å‘å½“å‰è¯·æ±‚
          return axios(config)
        } catch (err) {
          // åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬ç™»å½•é¡µ
          router.push('/login')
          return Promise.reject(err)
        } finally {
          isRefreshing = false
        }
      } else {
        // æ­£åœ¨åˆ·æ–°tokenï¼Œå°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—
        return new Promise(resolve => {
          requests.push(token => {
            config.headers.Authorization = `Bearer ${token}`
            resolve(axios(config))
          })
        })
      }
    }

    return Promise.reject(error)
  }
)
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼š**

1. **ä½¿ç”¨åŒtokenæœºåˆ¶**ï¼šaccessTokenï¼ˆçŸ­æœŸï¼‰+ refreshTokenï¼ˆé•¿æœŸï¼‰
2. **tokenå³å°†è¿‡æœŸæ—¶ä¸»åŠ¨åˆ·æ–°**ï¼šé¿å…è¯·æ±‚å¤±è´¥
3. **é™åˆ¶åˆ·æ–°æ¬¡æ•°**ï¼šé˜²æ­¢æ— é™å¾ªç¯
4. **å®‰å…¨å­˜å‚¨token**ï¼šä½¿ç”¨httpOnly cookieå­˜å‚¨refreshToken